/*! harmony-ui-components - v23.0.5 - 2016-11-16 
 * Copyright (c) 2016 Intuit; Licensed  */

define("hui/table/ColumnLocking",["dojo/_base/declare","dojo/aspect","dojo/on","dojo/has","../core/deviceUtils"],function(a,b,c,d,e){function f(a,b){for(1!==a.nodeType&&(a=a.parentNode);a&&!a[a.matches?"matches":"msMatchesSelector"](".dgrid-column-set["+j+"]");)if(a=a.parentNode,a===b)return null;return a}function g(a){var b=d("pointer"),c={start:"down",end:"up"};return b?(a=c[a]||a,"MS"===b.slice(0,2)?"MSPointer"+a.slice(0,1).toUpperCase()+a.slice(1):"pointer"+a):"touch"+a}function h(a){return function(b,d){var e=[c(b,g("start"),function(c){if(!a._currentlyTouchedColumnSet){var d=f(c.target,b);!d||c.pointerType&&"touch"!==c.pointerType&&2!==c.pointerType||(a._currentlyTouchedColumnSet=d,a._lastColumnSetTouchX=c.clientX,a._lastColumnSetTouchY=c.clientY)}}),c(b,g("move"),function(b){if(null!==a._currentlyTouchedColumnSet){var c=f(b.target);c&&(d.call(a,c,a._lastColumnSetTouchX-b.clientX),a._lastColumnSetTouchX=b.clientX,a._lastColumnSetTouchY=b.clientY)}}),c(b,g("end"),function(){a._currentlyTouchedColumnSet=null})];return{remove:function(){e.forEach(function(a){a.remove()})}}}}function i(a){return d("event-mousewheel")||d("event-wheel")?function(b,e){return c(b,d("event-wheel")?"wheel":"mousewheel",function(c){var d,g=f(c.target,b);g&&(d=c.deltaX||-c.wheelDeltaX/3,d&&e.call(a,g,d))})}:function(b,d){return c(b,".dgrid-column-set["+j+"]:MozMousePixelScroll",function(b){1===b.axis&&d.call(a,this,b.detail)})}}d.add("event-mousewheel",function(a,b,c){return"onmousewheel"in c}),d.add("event-wheel",function(a,b,c){return"onwheel"in c});var j="data-dgrid-column-set-id";return a(null,{_columnSetListeners:null,columnSets:null,postMixInProperties:function(){this.inherited(arguments),this._columnSetListeners=[]},postCreate:function(){this.inherited(arguments),this.lockedColumns&&this._setupColumnSetListeners()},_setupColumnSetListeners:function(){var a=this,b=this._columnSetListeners;b.length&&this._removeColumnSetListeners(),b.push(this.on(i(this),this._horizMoveHandler)),d("touch")&&b.push(this.on(h(this),this._horizMoveHandler)),b.push(this.on(".dgrid-column-set:dgrid-cellfocusin",function(b){a._onColumnSetCellFocus(b,this)}))},_removeColumnSetListeners:function(){this._columnSetListeners.forEach(function(a){a.remove()}),this._columnSetListeners=[]},_horizMoveHandler:function(a,b){var c=a.getAttribute(j),d=this._columnSetScrollers[c],e=d.scrollLeft+b;d.scrollLeft=e<0?0:e},renderArray:function(){var a=this.inherited(arguments);return a.forEach(function(a){this._adjustScrollLeft(a)},this),a},_adjustScrollLeft:function(a){var b=this._columnSetScrollLefts;Array.prototype.forEach.call(a.querySelectorAll(".dgrid-column-set"),function(a){a.scrollLeft=b[a.getAttribute(j)]})},createRowCells:function(a,b,c,d){if(!this.lockedColumns)return this.inherited(arguments);var e,f=document.createElement("table"),g=document.createElement("tbody"),h=document.createElement("tr"),i=arguments;return f.classList.add("dgrid-row-table"),f.setAttribute("role","presentation"),f.appendChild(g),g.appendChild(h),c=(c||this.subRows)[0],e=this.columnSets=[[c.slice(0,this.lockedColumns)],[c.slice(this.lockedColumns)]],e.forEach(function(c,e){var f=document.createElement(a),g=document.createElement("div");h.appendChild(f),f.classList.add("dgrid-column-set-cell"),f.classList.add("dgrid-column-set-"+e),f.appendChild(g),g.classList.add("dgrid-column-set"),g.setAttribute(j,e),g.appendChild(this.inherited(i,[a,b,c,d]))},this),f},renderHeader:function(){function a(){g._positionScrollers()}if(this.inherited(arguments),this.lockedColumns){var c,d,e=this.columnSets,f=this._columnSetScrollers,g=this;if(this._columnSetScrollerContents={},this._columnSetScrollLefts={},f)for(d in f)f[d].parentNode.removeChild(f[d]);else b.after(this,"styleColumn",a,!0),this._columnSetScrollerNode=c=document.createElement("div"),c.classList.add("dgrid-column-set-scroller-container"),this.footerNode.parentElement.insertBefore(c,this.footerNode.nextSibling);f=this._columnSetScrollers={},e.forEach(this._putScroller.bind(this)),this._positionScrollers()}},_putScroller:function(a,b){var d=this._columnSetScrollers[b]=document.createElement("span"),e=document.createElement("div");d.classList.add("dgrid-column-set-scroller"),d.classList.add("dgrid-column-set-scroller-"+b),d.setAttribute(j,b),this._columnSetScrollerNode.appendChild(d),e.classList.add("dgrid-column-set-scroller-content"),d.appendChild(e),this._columnSetScrollerContents[b]=e,c(d,"scroll",this._onColumnSetScroll.bind(this))},_onColumnSetScroll:function(a){var b,c=a.target.scrollLeft,d=a.target.getAttribute(j);this._columnSetScrollLefts[d]!==c&&(Array.prototype.forEach.call(this.domNode.querySelectorAll(".dgrid-column-set["+j+'="'+d+'"], .dgrid-column-set-scroller['+j+'="'+d+'"]'),function(a,d){e.isHandheld()?a.style.transform="translate3d(-"+c+"px, 0, 0)":a.scrollLeft=c,d||(b=c)}),this._columnSetScrollLefts[d]=b)},_positionScrollers:function(){var a,b,c=this.domNode,e=this._columnSetScrollers,f=this._columnSetScrollerContents,g=this.columnSets,h=0,i=0;g.forEach(function(d,g){a=c.querySelector(".dgrid-column-set["+j+'="'+g+'"]'),h=a.offsetWidth,b=a.firstChild.offsetWidth,f[g].style.width=b+"px",e[g].style.width=h+"px",b>h&&i++}),this._columnSetScrollerNode.style.bottom=this.showFooter?this.footerNode.offsetHeight+"px":"0",this.bodyNode.style.bottom=i?d("dom-scrollbar-height")+(d("ie")?1:0)+"px":"0"},_onColumnSetCellFocus:function(a,b){var c=a.target,d=b.getAttribute(j),e=this._columnSetScrollers[d],f=c.offsetLeft-e.scrollLeft+c.offsetWidth;(f>b.offsetWidth||e.scrollLeft>c.offsetLeft)&&this._scrollColumnSetTo(b,c.offsetLeft)},_scrollColumnSetTo:function(a,b){var c=a.getAttribute(j),d=this._columnSetScrollers[c];d.scrollLeft=b<0?0:b},_setLockedColumns:function(a){a<0&&(a=0),this.columnSets=null,this._resetColumnSizes(),this.lockedColumns=a,this._updateColumns(),this[a?"_setupColumnSetListeners":"_removeColumnSetListeners"]()},_resetColumnSizes:function(){for(var a in this._columnSizes)this._columnSizes[a].remove();this._columnSizes={}}})}),define("hui/table/CustomizablePagination",["dojo/string","dgrid/extensions/Pagination","dojo/on","dojo/when","dojo/_base/sniff","xstyle/css!dgrid/css/extensions/Pagination.css"],function(a,b,c,d){function e(a){var b=document.createElement("button");return b.appendChild(document.createTextNode(a.value)),b.classList.add(a.className),b.classList.add("dgrid-page-link"),b.setAttribute("aria-label",a.label),b.tabIndex=a.tabIndex||0,b}var f=b.prototype._updateNavigation;return b.extend({pagingLinks:0,firstLastArrows:!0,buildRendering:function(){this.inherited(arguments);var a=this.paginationNode=document.createElement("div"),b=this.paginationStatusNode=document.createElement("div"),d=this.paginationNavigationNode=document.createElement("div"),f=this.paginationLinksNode=document.createElement("div"),g=this,h=this.i18nPagination;a.classList.add("dgrid-pagination"),this.footerNode.appendChild(a),b.classList.add("dgrid-status"),d.classList.add("dgrid-navigation"),d.setAttribute("role","navigation"),d.setAttribute("aria-label",this.paginationAriaLabel),a.appendChild(d),f.classList.add("dgrid-pagination-links"),b.tabIndex=-1,this._updatePaginationSizeSelect(),this._updateRowsPerPageOption(),this._updatePaginationStatus(this._total),this.paginationFirstNode=e({className:"dgrid-first",value:this.paginationFirstText,label:h.gotoFirst}),d.appendChild(this.paginationFirstNode),this.paginationPreviousNode=e({className:"dgrid-previous",value:this.paginationPreviousText,label:h.gotoPrev}),d.appendChild(this.paginationPreviousNode),d.appendChild(b),d.appendChild(f),this.paginationNextNode=e({className:"dgrid-next",value:this.paginationNextText,label:h.gotoNext}),d.appendChild(this.paginationNextNode),this.paginationLastNode=e({className:"dgrid-last",value:this.paginationLastText,label:h.gotoLast}),d.appendChild(this.paginationLastNode),this._listeners.push(c(d,".dgrid-page-link:click,.dgrid-page-link:keydown",function(a){if("keydown"!==a.type||13===a.keyCode){var b,c,d=this.className;g._isLoading||d.indexOf("dgrid-page-disabled")>-1||(b=g._currentPage,c=Math.ceil(g._total/g.rowsPerPage),this===g.paginationPreviousNode?g.gotoPage(b-1):this===g.paginationNextNode?g.gotoPage(b+1):this===g.paginationFirstNode?g.gotoPage(1):this===g.paginationLastNode?g.gotoPage(c):"dgrid-page-link"===d&&g.gotoPage(+this.innerHTML))}})),this._paginationButtons=[this.paginationFirstNode,this.paginationPreviousNode,this.paginationNextNode,this.paginationLastNode]},refresh:function(a){a=a||{},a.keepCurrentPage=!(this._firstRun||!this._currentPage||a.keepCurrentPage===!1)||a.keepCurrentPage;var b=this,d=a&&a.keepCurrentPage?Math.min(this._currentPage,Math.ceil(this._total/this.rowsPerPage))||1:1;return(this.keepScrollPosition||a.keepScrollPosition)&&(a.keepCurrentPage||this.keepCurrentPage)&&(this._previousScrollPosition=this.getScrollPosition()),this.inherited(arguments),this.gotoPage(d).then(function(a){return setTimeout(function(){c.emit(b.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:b})},0),a})},gotoPage:function(){return this._renderedCollection?(this._currentPage!==arguments[0]&&this.clearSelection(),this.inherited(arguments)):d([])},_updateNavigation:function(a){f.call(this,a),this._paginationButtons.forEach(function(a){a.disabled=a.tabIndex===-1,a.removeAttribute("tabindex")})},_updatePaginationStatus:function(b){var c=this.rowsPerPage,d=Math.min(b,(this._currentPage-1)*c+1);this.paginationStatusNode.innerHTML=a.substitute(this.paginationText?this.paginationText:this.i18nPagination.status,{start:d,end:Math.min(b,d+c-1),total:b})},_setPaginationFirstText:function(a){this.paginationFirstText=a,this.paginationFirstNode.textContent=a},_setPaginationPreviousText:function(a){this.paginationPreviousText=a,this.paginationPreviousNode.textContent=a},_setPaginationNextText:function(a){this.paginationNextText=a,this.paginationNextNode.textContent=a},_setPaginationLastText:function(a){this.paginationLastText=a,this.paginationLastNode.textContent=a},_togglePaginationButtons:function(a){[this.paginationFirstNode,this.paginationPreviousNode,this.paginationNextNode,this.paginationLastNode].forEach(function(b){b.disabled=!a})}}),b}),define("hui/table/ContentGroups",["dojo/_base/declare","dgrid/Tree","dojo/has","dojo/query","dojo/Deferred","put-selector/put","dojo/has!touch?dgrid/util/touch","dojo/when","dojo/aspect"],function(a,b,c,d,e,f,g,h,i){return a(b,{_setCategoryProperty:function(a){this.categoryProperty=a,this.keepScrollPosition=!0},postCreate:function(){this.inherited(arguments);var a=function(){this._setCategoryTotals(this.categoryTotals)}.bind(this);i.after(this,"_hideColumn",a),i.after(this,"_showColumn",a)},_setExpandAll:function(a){this.expandAll!==a&&(this.expandAll=a,this.refresh())},renderHeader:function(){this.inherited(arguments),this._hideCategoryCell(this.headerNode)},renderRow:function(a){var b=this.inherited(arguments);return this.categoryProperty&&(a[this.categoryProperty]?this._showOnlyCategoryCell(b,a):this._hideCategoryCell(b)),b},shouldExpand:function(a){return!(arguments.length>1)&&(this.expandAll||a)},_setCategoryTotals:function(a){if(this.categoryProperty){this.categoryTotals=a||{};var b=this,c=new this.collection.Filter;c=c.or.apply(c,Object.keys(this.categoryTotals).map(function(a){return c.eq(b.categoryProperty,a)})),this.collection.filter(c).forEach(function(a){var c;b.categoryTotals.hasOwnProperty(c=a[b.categoryProperty])&&(b.categoryTotals[a.id]=b.categoryTotals[c],delete b.categoryTotals[c])}).then(function(){b.refresh()})}},_setTotalText:function(){this.inherited(arguments),this._setCategoryTotals(this.categoryTotals)},_renderCategoryTotalRow:function(a,b,c){var d=this._renderTotalRow(a,"_"+b+"TotalRow",c);d&&this._hideCategoryCell(d)},_showExpanded:function(a,b,c){var e,g,h;return h=b.element,h=h.className.indexOf("dgrid-expando-icon")>-1?h:d(".dgrid-expando-icon",h)[0],g=this.collection.getIdentity(b.data),e=void 0==a?!this._expanded[g]:a,f(h,".ui-icon-triangle-1-"+(e?"se":"e")+"!ui-icon-triangle-1-"+(e?"e":"se")),f(b.element,(e?".":"!")+"dgrid-row-expanded"),c&&c.setAttribute("aria-expanded",e?"true":"false"),e?this._expanded[g]=!0:this._expanded[g]=!1,e},expand:function(a,b,c,d){if(!this._treeColumn)return h();var f,g,i,j,k,l,m=this,n=a.element?a:this.row(a),o=this.getScrollPosition();return d=d||d!==!1&&(!this.collection.mayHaveChildren||this.collection.mayHaveChildren(n.data)),a&&d?(g=this._showExpanded(b,n,c),f=this.collapseOnRefresh,this.collapseOnRefresh=!1,l=this.farOffRemoval,this.farOffRemoval=1/0,i=this.refresh(),!m.on||i&&i.then||(j=new e,i=j.promise,k=m.on("dgrid-refresh-complete",function(){j.resolve()})),h(i,function(){return k&&k.remove(),o&&m.gotoPage&&m.scrollTo(o),m.farOffRemoval=l,m.collapseOnRefresh=f,g})):h()},_clicked:null,_configureTreeColumn:function(a){var b=this,d=".dgrid-content .dgrid-column-"+a.id,e=a.renderCell||this._defaultRenderCell;if(this._treeColumn=a,!b.collection)throw new Error("dgrid Tree mixin requires a collection to operate.");"function"!=typeof a.renderExpando&&(a.renderExpando=this._defaultRenderExpando),this._treeColumnListeners.push(this.on(a.expandOn||d+":click,.ha-expando-button:click,.ha-expando-button:keydown",this._onClick.bind(this))),c("touch")&&this._treeColumnListeners.push(this.on(g.selector(d,g.dbltap),function(){b.expand(this)})),a.renderCell=function(c,d,f,g){b._renderCell(a,e,c,d,f,g)}},_renderCell:function(a,b,c,d,e,g){var h,i,j=a.grid,k=Number(g&&g.queryLevel)+1,l=!j.collection.mayHaveChildren||j.collection.mayHaveChildren(c);k=j._currentLevel=isNaN(k)?0:k,h=a.renderExpando(k,l,j._expanded[j.collection.getIdentity(c)],c),h.level=k,h.mayHaveChildren=l,i=b.call(a,c,d,e,g),i&&i.nodeType?(f(e,h),f(e,i)):e.insertBefore(h,e.firstChild)},_onClick:function(a){var b,c=this.row(a),d=c?c.id:"",e=this;this.collection.mayHaveChildren&&!(b=this.collection.mayHaveChildren(c?c.data:null))||"keydown"===a.type&&32!==a.keyCode||("keydown"===a.type&&32===a.keyCode&&(a.preventDefault(),a.stopPropagation()),this.expand(c,null,null,b).then(function(a){if(a&&d){var b=e.row(d);b&&b.element&&b.element.nextSibling&&b.element.nextSibling.focus()}})),a.target.classList.contains("dgrid-expando-icon")&&(this._clicked&&this._clicked.id===this.row(a).id?this._clicked.count++:this._clicked={id:this.row(a).id,count:1})},renderQueryResults:function(){var a=this,b=this.inherited(arguments);return this.categoryTotals?b.then(function(b){var c,d,e,f,g,h=b&&b.length?b[b.length-1]:null;for(c=0;c<b.length;c++)g=f,d=g&&g.data.parent,f=a.row(b[c]),null==f.data.parent&&a._expanded[d]&&(e=a.categoryTotals[d])&&a._renderCategoryTotalRow(e,d,f.element);return h&&h.rowIndex>=a._total&&(f=a.row(h),f&&(e=a.categoryTotals[f.data.parent])&&a._renderCategoryTotalRow(e,f.data.parent,a._totalRow||null)),b}):b},insertRow:function(){var a=this.inherited(arguments),b=this.row(a),c=this.shouldExpand(b&&this._expanded[b.id]);return c&&this._showExpanded(!0,b,a.querySelector(".ha-expando-button")),a},_defaultRenderExpando:function(){var a=b.prototype._defaultRenderExpando.apply(this,Array.prototype.slice.call(arguments));return"left"===a.style.float?a.style.float="right":a.style.float="left",a},_hideCategoryCell:function(a){this.categoryProperty&&Array.prototype.slice.apply(a.getElementsByClassName("field-"+this.categoryProperty)).forEach(function(a){a.classList.add("hidden")})},_showOnlyCategoryCell:function(a){var b=this.categoryProperty;b&&(a.classList.add("category-row"),Array.prototype.slice.apply(a.querySelectorAll('[class*="field-"]')).forEach(function(a){if(a.classList.contains("field-"+b)){a.classList.add("category-column");var c,d,e=document.createElement("button"),f=document.createElement("span");for(e.classList.add("ha-expando-button"),e.setAttribute("aria-expanded","false"),e.setAttribute("tabindex","0"),f.classList.add("sr-only"),f.textContent="expand/collapse "+a.textContent.trim(),c=a.children.length-1;c>=0;c--)d=a.children[c],a.removeChild(d),d.style.float&&e.classList.add("ha-expando-"+d.style.float),e.insertBefore(d,e.firstChild);e.insertBefore(f,e.firstChild),a.appendChild(e)}else a.classList.add("hidden")}))},_getExpanded:function(){var a,b=[];for(a in this._expanded)this._expanded.hasOwnProperty(a)&&(this.expandAll||this._expanded[a])&&b.push(a);return b}})}),define("hui/table/ContentGroupPagination",["dojo/_base/declare","dojo/when","put-selector/put","./CustomizablePagination","./ContentGroups"],function(a,b,c,d,e){function f(a){a.noDataNode?(c(a.noDataNode,"!"),delete a.noDataNode):a.cleanup(),a.contentNode.innerHTML=""}function g(a){if(a.loadingNode)c(a.loadingNode,"!"),delete a.loadingNode;else if(a._oldPageNodes){for(var b in a._oldPageNodes)a.removeRow(a._oldPageNodes[b]);delete a._oldPageNodes}delete a._isLoading}return a([d,e],{_renderNoDataDivs:function(){var a=this;Array.prototype.map.call(a.contentNode.getElementsByClassName("category-row"),function(b){return a.row(b)}).forEach(function(b){if(b&&a._expanded[a.collection.getIdentity(b.data)]&&(b.element.parentNode.lastChild===b.element||b.element.nextSibling.classList.contains("category-row"))){var c=document.createElement("div");c.classList.add("ha-table-no-data"),c.textContent="No Data Available",b.element.nextSibling?b.element.parentNode.insertBefore(c,b.element.nextSibling):b.element.parentNode.appendChild(c)}})},gotoPage:function(a){var d=this,e=(this._currentPage-1)*this.rowsPerPage;return this._renderedCollection?(this._currentPage!==arguments[0]&&this.clearSelection(),this._renderedCollection.releaseRange&&this._renderedCollection.releaseRange(e,e+this.rowsPerPage),this._trackError(function(){var e,h,i,j,k,l,m=d.rowsPerPage,n=(a-1)*m,o={start:n,count:m},p=d.contentNode,q=d._getExpanded();if(d.showLoadingMessage)f(d),h=d.loadingNode=c(p,"div.dgrid-loading[role=alert]"),h.innerHTML=d.loadingMessage;else for(d._oldPageNodes=i={},j=p.children,k=0,l=j.length;k<l;k++)i[j[k].id]=j[k];return d._isLoading=!0,e=d._renderedCollection.fetchGroupRange?d._renderedCollection.fetchGroupRange({start:n,end:n+m,expanded:q}):d._renderedCollection.fetchRange({start:n,end:n+m}),d.renderQueryResults(e,null,o).then(function(f){return g(d),d._previousScrollPosition?(d.scrollTo(d._previousScrollPosition),d._previousScrollPosition=null):d.scrollTo({y:0}),d._rows&&(d._rows.min=n,d._rows.max=n+m-1),b(e.totalLength,function(g){g||(d.noDataNode&&(c(d.noDataNode,"!"),delete d.noDataNode),d.noDataNode=c(d.contentNode,"div.dgrid-no-data[role=gridcell]"),d.noDataNode.innerHTML=d.noDataMessage),b(e,function(c){b(c.start,function(e){a=e?(e-1)/m+1:a,d._total=g,d._currentPage=a,d._rowsOnPage=f.length,d._updatePaginationStatus(g),b(c.isLastPage,function(a){a?(d._updateNavigation(g),d.paginationNextNode.disabled=d.paginationLastNode.disabled=!0,d.paginationNextNode.classList.add("dgrid-page-disabled"),d.paginationLastNode.classList.add("dgrid-page-disabled")):(d.paginationNextNode.disabled=d.paginationLastNode.disabled=!1,d.paginationNextNode.classList.remove("dgrid-page-disabled"),d.paginationLastNode.classList.remove("dgrid-page-disabled"),d._updateNavigation(g))})})})}),d._renderNoDataDivs(),e},function(a){throw g(d),a})})):b([])}})}),define("hui/table/OnDemandContentGroups",["dojo/_base/declare","dojo/on","dgrid/Grid","dgrid/OnDemandList","./ContentGroups"],function(a,b,c,d,e){return d.extend({_renderNoDataDivs:function(){var a=this;Array.prototype.map.call(a.contentNode.getElementsByClassName("category-row"),function(b){return a.row(b)}).forEach(function(b){if(b&&a._expanded[a.collection.getIdentity(b.data)]&&(b.element.nextSibling.classList.contains("dgrid-preload")||b.element.nextSibling.classList.contains("category-row"))){var c=document.createElement("div");c.classList.add("ha-table-no-data"),c.textContent="No Data Available",b.element.parentNode.insertBefore(c,b.element.nextSibling)}})},refresh:function(a){var c=this,d=a&&a.keepScrollPosition,e=c._getExpanded();if("undefined"==typeof d&&(d=this.keepScrollPosition),d&&(!this.categoryProperty||e.length>0)&&(this._previousScrollPosition=this.getScrollPosition()),this.inherited(arguments),this._renderedCollection)return this.renderQuery(function(a){return c._renderedCollection.fetchGroupRange&&Math.abs(a.start+a.count-(c._total?c._total:0))<Object.keys(c._expanded).length&&(a.count+=Object.keys(c._expanded).length),c._renderedCollection.fetchGroupRange?c._renderedCollection.fetchGroupRange({start:a.start,end:a.start+a.count,expanded:e,virtual:!0}):c._renderedCollection.fetchRange({start:a.start,end:a.start+a.count})}).then(function(){setTimeout(function(){c._renderNoDataDivs(),b.emit(c.domNode,"dgrid-refresh-complete",{bubbles:!0,cancelable:!1,grid:c})},0)})}}),a([c,d,e],{_processScroll:function(){var a;return(!this.categoryProperty||this._getExpanded().length>0)&&(this._isProcessingScroll=!0,a=this.inherited(arguments),a?a.then(function(){this._isProcessingScroll=!1}):setTimeout(function(){this._isProcessingScroll=!1},100)),this._renderNoDataDivs(),this._applyA11yRoles(),a}})}),define("hui/table/ColumnHider",["dgrid/extensions/ColumnHider"],function(a){return a.extend({postMixInProperties:function(){this.inherited(arguments),this._columnHiderRules={}},renderHeader:function(){this._columnHiderCheckboxes={},this._columnHiderRules={},this.inherited(arguments)},toggleColumnHiddenState:function(a,b){"undefined"==typeof b&&(b=!this._columnHiderRules[a]),this._updateColumnHiddenState(a,b),this._columnHiderCheckboxes[a]&&(this._columnHiderCheckboxes[a].checked=!b)}}),a}),define("hui/table/TableDndSource",["dgrid/extensions/DnD","dojo/dnd/common","dojo/dnd/Manager","dojo/dnd/autoscroll","dojo/dnd/Selector","dojo/_base/declare","dojo/has","dojo/on"],function(a,b,c,d,e,f,g,h){return c.extend({onMouseMove:function(a){if(!this.dragging){var c,e,f=this.avatar;f&&(d.autoScrollNodes(a),c=f.node.style,c.left=a.pageX+this.OFFSET_X+"px",c.top=a.pageY+this.OFFSET_Y+"px",e=Boolean(this.source.copyState(b.getCopyKeyState(a))),this.copy!==e&&this._setCopyStatus(e)),g("touch")&&a.preventDefault()}}}),f(a.GridSource.extend({onDndStart:function(a){if(this.inherited(arguments),a===this){this.grid.cancelTouchScroll&&this.grid.cancelTouchScroll();var b=c.manager().avatar.node,d=b.querySelector(".dojoDndAvatarHeader"),e=b.querySelectorAll(".dgrid-selected"),f=b.querySelectorAll(".dojoDndAvatarItem"),g=this.grid.domNode.querySelector(".dgrid-row");f&&Array.prototype.forEach.call(f,function(a){a.style.opacity="",a.classList.add("ha-table-drag-and-drop")}),b.style.width=g?g.offsetWidth+"px":"",d&&d.parentNode.removeChild(d),e&&Array.prototype.forEach.call(e,function(a){a.classList.remove("dgrid-selected")}),a.grid.domNode.parentNode.classList.contains("compact")?b.classList.add("compact"):a.grid.domNode.parentNode.classList.contains("double")&&b.classList.add("double"),Array.prototype.forEach.call(a.grid.domNode.querySelectorAll(".dgrid-row"),function(a){a.setAttribute("aria-dropeffect","move")})}},getSelectedNodes:function(){return this.inherited(arguments)}}),{SpaceKeyCode:32,EscapeKeyCode:27,ArrowUpKeyCode:38,ArrowDownKeyCode:40,EnterKeyCode:13,MKeyCode:77,scrollListener:null,dragging:!1,scrollCushion:50,_targetIcon:null,onDndCancel:function(){this.inherited(arguments),Array.prototype.forEach.call(this.grid.domNode.querySelectorAll(".dgrid-row"),function(a){a.removeAttribute("aria-dropeffect")}),this.dragging=!1,c.manager().dragging=!1,this.scrollListener.resume()},onDndDrop:function(){this.inherited(arguments),Array.prototype.forEach.call(this.grid.domNode.querySelectorAll(".dgrid-row"),function(a){a.removeAttribute("aria-dropeffect")}),this.dragging=!1,c.manager().dragging=!1,this.scrollListener.resume()},constructor:function(){this._targetIcon=document.createElement("div"),this.grid&&this.grid.domNode&&this.grid.domNode.parentNode&&this.grid.domNode.parentNode.appendChild(this._targetIcon),this._targetIcon.classList.add("hidden"),this._targetIcon.classList.add("hi"),this._targetIcon.classList.add("hi-adjust"),this._targetIcon.classList.add("drag-and-drop-target-icon"),this.scrollListener=h.pausable(this.node,"scroll",this._unmarkTargetAnchor.bind(this)),this.events.push(this.scrollListener,h(this.node,".ha-dnd-button:keydown",this.onKeyDown.bind(this)))},_markTargetAnchor:function(a,b){this.inherited(arguments);var d,e,f;this.targetAnchor&&(e=this.targetAnchor.getBoundingClientRect(),f=a?e.top-12:e.bottom-13,this._targetIcon.style.top=f+(window.scrollY||window.pageYOffset)+"px",this._targetIcon.style.left=e.left-20+"px",this._targetIcon.classList.remove("hidden"),b&&(d=c.manager().avatar,d.node.style.left=e.left+Math.min(this.targetAnchor.offsetWidth/5,75)+"px",d.node.style.top=e.bottom+(window.scrollY||window.pageYOffset)+this.targetAnchor.offsetHeight+"px"))},_unmarkTargetAnchor:function(){this.inherited(arguments),this._targetIcon.classList.add("hidden")},onMouseOver:function(){this.dragging||this.inherited(arguments)},onMouseMove:function(){this.dragging||this.inherited(arguments)},onDndSourceOver:function(){this.dragging||this.inherited(arguments)},onKeyDown:function(a){var b,d,f,g=a.target.getBoundingClientRect(),h=c.manager();this.dragging?(d=this.grid.row(this.current||a.target),(b=a.keyCode===this.ArrowUpKeyCode)||a.keyCode===this.ArrowDownKeyCode?(a.preventDefault(),f=b?d&&d.element&&d.element.previousSibling?d.element.previousSibling:this.current?this.current.previousSibling:null:d&&d.element&&d.element.nextSibling?d.element.nextSibling:this.current?this.current.nextSibling:null,f&&f.classList.contains("dgrid-row")&&(this._unmarkTargetAnchor(),f.offsetTop>this.grid.bodyNode.scrollTop+this.grid.bodyNode.offsetHeight-this.scrollCushion?this.grid.scrollTo({y:this.grid.bodyNode.scrollTop+f.offsetHeight}):f.offsetTop<this.grid.bodyNode.scrollTop&&this.grid.scrollTo({y:this.grid.bodyNode.scrollTop-f.offsetHeight}),this.current=f,this._markTargetAnchor(!1,!0))):a.keyCode===this.MKeyCode&&a.ctrlKey||a.keyCode===this.EnterKeyCode?(h.canDropFlag=!0,h.onMouseUp(a)):a.keyCode===this.EscapeKeyCode&&(h.stopDrag(),this.onDndCancel())):(d=this.grid.row(a.target),a.keyCode===this.SpaceKeyCode&&(this.current=d&&d.element?d.element:a.target,this.dragging=!0,c.manager().dragging=!0,this.scrollListener.pause(),a.target.hasAttribute("aria-grabbed")&&a.target.setAttribute("aria-grabbed",!0),h.startDrag(this,[d.element],!1),this._lastX=g.left,this._lastY=g.top,e.prototype.onMouseDown.call(this,a),this.onDndStart(this,[d.element]),this._markTargetAnchor(!1,!0)))}})}),define("hui/table/RowReordering",["dojo/_base/declare","dojo/_base/lang","dgrid/extensions/DnD","./TableDndSource","../core/utils"],function(a,b,c,d,e){return a(c,{allowRowReordering:!1,rowReorderField:"_rowReorder",_reorderIconText:"Reorder Row",dndConstructor:d,dndEnabled:!1,postMixInProperties:function(){this.inherited(arguments),this.dndParams=b.mixin({withHandles:!0},this.dndParams)},_enableDnd:function(a){this.dndEnabled=a,Array.prototype.forEach.call(this.domNode.querySelectorAll(".hi-arrange"),this._toggleIcon.bind(null,a))},_toggleIcon:function(a,b){b&&(a?(b.parentNode.setAttribute("aria-grabbed","false"),b.classList.remove("disabled-dnd-handle"),b.parentNode.parentNode.classList.add("dojoDndHandle"),b.parentNode.classList.add("ha-dnd-button")):(b.parentNode.setAttribute("aria-grabbed",""),b.classList.add("disabled-dnd-handle"),b.parentNode.parentNode.classList.remove("dojoDndHandle"),b.parentNode.classList.remove("ha-dnd-button")))},_setReorderIconText:function(a){this._reorderIconText=a,this.refresh()},_setBatchModeActive:function(a){this.inherited(arguments),this._enableDnd(!a)},_setEditable:function(a){this.inherited(arguments),this._enableDnd(!a)},renderRow:function(){var a=this.inherited(arguments);return this._toggleIcon(this.dndEnabled,a.querySelector(".hi-arrange")),a},_setAllowRowReordering:function(a){this.allowRowReordering=a,this.set("columns",this.table&&this.table.originalColumns?e.clone(this.table.originalColumns,[this]):this.__columns),this._enableDnd(a)},_addCustomColumn:function(a){this.inherited(arguments),this.get("allowRowReordering")&&a.unshift(this._defineRowReorderColumn())},_defineRowReorderColumn:function(){var a={field:this.rowReorderField,sortable:!1,unhidable:!0};return a.renderCell=this._renderReorderCell.bind(this),a.renderHeaderCell=function(a){a.textContent=""},a},_renderReorderCell:function(){var a=arguments[2],b=document.createElement("button"),c=document.createElement("span"),d=document.createElement("span");a.classList.add("dojoDndHandle"),c.classList.add("hi-arrange"),c.classList.add("hi"),c.setAttribute("aria-hidden",!0),d.textContent=this._reorderIconText,d.classList.add("icon-text"),b.setAttribute("aria-grabbed",!1),b.classList.add("ha-dnd-button"),b.appendChild(c),b.appendChild(d),a.appendChild(b),a.addEventListener("pointerdown",this._stopPropagation),a.addEventListener("MSPointerDown",this._stopPropagation),a.addEventListener("click",this._stopPropagation),a.addEventListener("mousedown",this._delegateToDnDMouseDown.bind(this))},_delegateToDnDMouseDown:function(a){this.dndSource&&this.dndSource.onMouseDown&&this.dndSource.onMouseDown(a)},_stopPropagation:function(a){a.stopPropagation()}})}),define("hui/table/RowDeletion",["dojo/_base/declare"],function(a){return a(null,{allowRowDeletion:!1,_rowDeletionField:"_rowDelete",_deletionIconText:"Delete Row",_deletionIconClass:"hi-delete",_setDeletionIconText:function(a){this._deletionIconText=a,this.refresh()},_setDeletionIconClass:function(a){this._deletionIconClass=a,this.refresh()},_setAllowRowDeletion:function(a){this.allowRowDeletion=a,this.set("columns",this.__columns)},_getColumns:function(){return this.__columns||this.inherited(arguments)},_addCustomColumn:function(a){this.inherited(arguments),this.get("allowRowDeletion")&&a.push(this._defineRowDeletionColumn())},_defineRowDeletionColumn:function(){var a={field:this._rowDeletionField,sortable:!1,unhidable:!0};return a.renderCell=this._renderDeletionCell.bind(this),a.renderHeaderCell=function(a){a.textContent=""},a},_clickHandler:function(a){a.stopPropagation(),a.preventDefault();var b=this.row(a);b&&(this._previousScrollPosition=this.getScrollPosition(),this.collection.remove(b.id),this.virtual&&this.refresh())},_renderDeletionCell:function(){var a=arguments[2],b=document.createElement("button"),c=document.createElement("span"),d=document.createElement("span");c.classList.add(this._deletionIconClass),c.classList.add("hi"),c.setAttribute("aria-hidden",!0),d.textContent=this._deletionIconText,d.classList.add("icon-text"),b.appendChild(c),b.appendChild(d),a.appendChild(b),b.addEventListener("click",this._clickHandler.bind(this))}})}),define("hui/table/Editor",["dojo/_base/declare","dgrid/Editor","dojo/on"],function(a,b,c){return a(b.extend({_createEditor:function(a){var b,c=a.editor,d=this;return this._hasInputListener||(this._hasInputListener=!0,this.on("change",function(b){d._handleEditorChange(b,a)})),b=document.createElement(c),b.classList.add("dgrid-input"),b.name=a.field,b.tabIndex=isNaN(a.tabIndex)?-1:a.tabIndex,b.setAttribute("aria-label",a.label),a.autoSelect&&b.select&&b.addEventListener("focus",function(){setTimeout(function(){b.select()},0)}),b},_configColumns:function(){var a=this.inherited(arguments);return this._alwaysOnWidgetColumns=[],a.forEach(function(a){this.editable&&a.editor?this._configureEditorColumn(a):a.renderCell=a._originalRenderCell||a.renderCell}.bind(this)),a},_configureEditorColumn:function(a){var b=a.editor,d=this,e=a.editOn,f=a.renderCell||this._defaultRenderCell,g="string"!=typeof b;e?this._editorInstances[a.id]=this._createSharedEditor(a,f):g&&this._alwaysOnWidgetColumns.push(a),a._originalRenderCell=a._originalRenderCell||f,a.renderCell=e?function(a,b,f,g){g&&g.alreadyHooked||d._editorColumnListeners.push(c(f,e,function(){d._activeOptions=g,d.edit(this)}))}:function(b,c,e,h){if(!d._isEditable(a.field)||a.canEdit&&!a.canEdit(b,c))return f.call(a,b,c,e,h);var i=d._createEditor(a);d._showEditor(i,a,e,c),e[g?"widget":"input"]=i}.bind(this)},_handleEditorChange:function(a,b){
var c=a.target;"_dgridLastValue"in c&&c.classList.contains("dgrid-input")&&this._updatePropertyFromEditor(b||this.cell(c).column,c,a)}}),{_setEditable:function(a){var b=this.editable;this.editable=a,"undefined"==typeof this.editableFields&&(this.editableFields=this.getAvailableEditableFields()),b!==a&&this._configEditMode()},getAvailableEditableFields:function(){var a=[];return Object.keys(this.columns).forEach(function(b){var c=this.columns[b];c.editor&&a.push(c.field)}.bind(this)),a},_setEditMode:function(a){var b=this.editMode;this.editMode=a,b!==a&&this._configEditMode()},_isEditable:function(a){return this.editable&&this.getAvailableEditableFields().indexOf(a)>-1&&("specific"!==this.editMode||this.editableFields&&this.editableFields.indexOf(a)>-1)},_configEditMode:function(){this.configStructure(),this.refresh()},_showEditor:function(a,b,c,d){return b.editorInit&&b.editorInit(a,d,b),this.inherited(arguments)}})}),define("hui/table/RowStatusIndicator",["dojo/_base/declare"],function(a){return a(null,{renderRow:function(a){var b,c=this.inherited(arguments);return this.rowStatus&&("string"==typeof this.rowStatus?b=a[this.rowStatus]:"function"==typeof this.rowStatus&&(b=this.rowStatus(a)),"error"===b?(c.classList.remove("success"),c.classList.remove("warning"),c.classList.add("error")):"success"===b?(c.classList.remove("error"),c.classList.remove("warning"),c.classList.add("success")):"warning"===b?(c.classList.remove("error"),c.classList.remove("success"),c.classList.add("warning")):(c.classList.remove("success"),c.classList.remove("error"),c.classList.remove("warning"))),c}})}),define("hui/table/RowErrors",["dojo/_base/declare","dojo/_base/lang"],function(a,b){return a(null,{_rowErrors:null,postMixInProperties:function(){this.inherited(arguments),this._rowErrors={}},renderRowError:function(a,b){if(!a)return b;var c,d=document.createElement("div"),e=document.createElement("span"),f=document.createElement("div");return e.classList.add("hi-circle-alert"),e.classList.add("hi"),"string"==typeof a?(c=document.createElement("span"),c.textContent=a):a instanceof HTMLElement&&(c=a),d.appendChild(e),c&&d.appendChild(c),f.classList.add("dgrid-row-alert"),f.appendChild(d),f.appendChild(b),f},setError:function(a,b){this.setErrors([a],[b])},setErrors:function(a,c){var d,e,f,g,h=this;if(a&&c)for(d=0;d<a.length;d++)e=a[d]?this.row(a[d]):null,f=e?e.id:null,g=c[d],f&&g&&(this._rowErrors[f]=g,this.reRenderRow(e));else a&&"object"==typeof a&&(b.mixin(this._rowErrors,a),Object.keys(a).forEach(function(a){h.reRenderRow(a)}))},clearSelection:function(){return this.clearErrors(),this.inherited(arguments)},clearError:function(a){this.clearErrors([a])},clearErrors:function(a){if(a){var b=this._rowErrors,c=this;a.forEach(function(a){var d=a?c.row(a):null,e=d?d.id:null;e&&b[e]&&(b[e]=void 0,c.reRenderRow(d))})}else this._rowErrors={},this.refresh({keepCurrentPage:!0,keepScrollPosition:!0})},renderRow:function(a){var b=this.inherited(arguments),c=this._rowErrors[this.collection.getIdentity(a)];return c?this.renderRowError(c,b):b}})}),define("hui/table/BatchMode",["dojo/_base/declare","dgrid/Selector","../core/utils","../checkbox"],function(a,b,c){return a(b,{deselectOnRefresh:!1,batchField:"_batch",shouldSelect:function(a){var b=!0;if(a&&a.target&&("HA-CHECKBOX"!==a.target.tagName&&"HA-RADIO-BUTTON"!==a.target.tagName&&"INPUT"!==a.target.tagName&&"BUTTON"!==a.target.tagName&&"A"!==a.target.tagName||(b=!1),!b))for(var c=a.target;c&&"HA-TABLE"!==c.tagName;)c.classList.contains("field-"+this.batchField)?(b=!0,c=null):c=c.parentElement;return b},batchModeEnabled:!0,startup:function(){this._started||(this.set("columns",this.table&&this.table.originalColumns?c.clone(this.table.originalColumns,[this]):this.get("columns")),this.inherited(arguments))},_setSelectionMode:function(a){return this._selectionMode=a,this.inherited(arguments,[this.allowBatchMode&&this.batchModeEnabled?this._selectionMode:"none"])},_setBatchModeEnabled:function(a){this.inherited(arguments),Array.prototype.forEach.call(this.domNode.querySelectorAll(".field-_batch ha-checkbox"),function(b){b.disabled=!a}),this.batchModeEnabled=a,this.set("selectionMode",this._selectionMode)},_setEditable:function(a){this.inherited(arguments),this.set("batchModeEnabled",!a)},_setAllowBatchMode:function(a){this.allowSelectAll=!0,this.allowBatchMode=a,this.set("selectionMode",this._selectionMode),this.set("columns",this.table&&this.table.originalColumns?c.clone(this.table.originalColumns,[this]):this.__columns)},_addCustomColumn:function(a){this.inherited(arguments),this.batchModeEnabled&&this.allowBatchMode&&a.unshift({selector:!0,field:this.batchField}),this.inherited(arguments,[a])},allowSelect:function(a){return!!a&&(!a.element||!a.element.classList.contains("category-row"))},_convertColumns:function(a){if(Array.isArray(a))return a.map(function(a){return a.id=null,a});var b=Object.keys(a).map(function(b){var c=a[b];return"string"==typeof c?{field:b,label:c}:(c.field=b,c.id=null,c)});return b},_setBatchSelectAriaLabel:function(a){this._batchSelectAriaLabel=a,this.refresh()},_setBatchSelectAllAriaLabel:function(a){this._batchSelectAllAriaLabel=a;var b=this.domNode&&this.domNode.querySelector(".dgrid-header .field-_batch .sr-only");b&&(b.textContent=a)},_setBatchSelectAllHeaderAriaLabel:function(a){this._batchSelectAllHeaderAriaLabel=a;var b=this.domNode&&this.domNode.querySelector(".dgrid-header th.field-_batch");b&&(b.textContent=a)},_defaultRenderSelectorInput:function(a,b,c,d){var e=c.parentNode,f=a.grid,g=c.input||(c.input=document.createElement("ha-checkbox"));return c.appendChild(g),(e&&e.contents?e:c).classList.add("dgrid-selector"),a.tabIndex&&(g.tabIndex=a.tabIndex),g.disabled=!f.collection||!f.allowSelect(f.row(d)),g.checked=b,g.setAttribute("aria-checked",b),g.ariaLabel=f._batchSelectAriaLabel,g},_configureSelectorColumn:function(a){var b,c=a.selector;this._selectorColumns.push(a),this._selectorSingleRow=this._selectorSingleRow||"radio"===a.selector,b="function"==typeof c?c:this._defaultRenderSelectorInput,a.sortable=!1,a.unhidable=!0,a.renderCell=function(c,d,e){var f=c&&this.row(c);d=f&&this.selection[f.id],b(a,!!d,e,c);var g=e.querySelector("input");g&&g.setAttribute("aria-label",this._batchSelectAriaLabel)}.bind(this),a.renderHeaderCell=function(c){a.tabIndex=null;var d=a._selectorHeaderCheckbox=b(a,!1,c,{});c.classList.remove("dgrid-cell"),c.classList.add("batch-header-cell"),this._hasSelectorHeaderCheckbox=!0,c.setAttribute("aria-label",this._batchSelectAllHeaderAriaLabel),d.removeAttribute("aria-label"),d.querySelector("input").setAttribute("aria-label",this._batchSelectAllAriaLabel)}.bind(this)},_handleSelectorClick:function(a){if(32!==a.keyCode)return this.inherited(arguments)},_handleSelect:function(a){if(this.shouldSelect(a))return this.inherited(arguments)}})}),define("hui/table/PersistentSort",["dojo/_base/declare"],function(a){return a(null,{postMixInProperties:function(){this.inherited(arguments),this._loadLastSort()},_saveLastSort:function(){this.userId&&this.persistentId&&window.localStorage&&this.sort&&this.sort.length&&window.localStorage.setItem(this.userId+this.persistentId,JSON.stringify(this.sort))},_loadLastSort:function(){var a;if(this.userId&&this.persistentId&&window.localStorage)try{(a=JSON.parse(window.localStorage.getItem(this.userId+this.persistentId)))&&this.set("sort",a)}catch(a){}return Boolean(a)},_setSort:function(){this.inherited(arguments),this._saveLastSort()},_setUserId:function(a){this.userId=a,this._loadLastSort()||this._saveLastSort()},_setPersistentId:function(a){this.persistentId=a,this._loadLastSort()||this._saveLastSort()}})}),define("hui/table/DefaultRenderer",["object-utils/classes"],function(a){return a.extend(Object,{constructor:function(a){this.tableConfig=a||{}},row:function(a,b,c){return c()},header:function(a){if(a(),this.table)return this.table.querySelector(".ha-table-header")},setup:function(){},cleanup:function(){}})}),define("hui/table/rendererFactoryFactory",["../core/utils","object-utils/classes","./DefaultRenderer"],function(a,b,c){return function(b){b=b||{},b.default=[new c],Object.keys(b).forEach(function(a){b[a]&&!Array.isArray(b[a])&&(b[a]=[b[a]])});var d=function(c,d,e){var f,g,h;if(f=b[c]||b.default,f.forEach(function(a){a.table=e.table}),"columns"===d)return b.default.columns||(b.default.columns=e.table.originalColumns),a.clone(f.reduce(function(a,b){return b.columns||a},b.default.columns),[e]);if("tableConfig"===d){if(b.default.tableConfig=b.default.tableConfig||{},g=f.reduce(function(b,c){return c.tableConfig?a.mixin(b||{},c.tableConfig):b},null)){for(h in g)b.default.tableConfig.hasOwnProperty(h)||(b.default.tableConfig[h]=e.get(h));g=a.mixin({},b.default.tableConfig,g)}else g=b.default.tableConfig;return g}return"header"===d?function(a){var c=f.reduce(function(a,b){return b.header?b.header.bind(b,a):a},a);return c===a?b.default[0].header(a):c()}:"row"===d?function(a,c,d){var e=f.reduce(function(b,d){return d.row?d.row.bind(d,a,c,b):b},d);return e===d?b.default[0].row(a,c,d):e()}:function(a){var c=!1;f.forEach(function(b){b[d]&&(b[d](a),c=!0)}),!c&&b.default[d]&&b.default[d](a)}};return d.addRenderMode=function(c){var d={columns:b.default.columns,tableConfig:b.default.tableConfig};b[c]=Array.prototype.slice.call(arguments,1),"default"===c&&a.mixin(b.default,d)},d.removeRenderMode=function(a){delete b[a],"default"===a&&(b.default=[new c])},d.resetConfig=function(a){b.default.columns=a.table.originalColumns;var c;b.default.tableConfig=b.default.tableConfig||{};for(c in b.default.tableConfig)b.default.tableConfig[c]=a.get(c)},d}}),define("hui/table/scopeListStyles",["dojo/has","dgrid/Grid","dgrid/List","dgrid/util/misc"],function(a,b,c,d){var e,f;c.extend({resize:function(){var b=this.bodyNode,c=this.headerNode,g=this.footerNode,h=c.offsetHeight,i=this.showFooter?g.offsetHeight:0;this.headerScrollNode.style.height=b.style.marginTop=h+"px",b.style.marginBottom=i+"px",e||(e=a("dom-scrollbar-width"),f=a("dom-scrollbar-height"),a("ie")&&(e++,f++),d.addCssRule("ha-table .dgrid-scrollbar-width","width: "+e+"px"),d.addCssRule("ha-table-virtual .dgrid-scrollbar-width","width: "+e+"px"),d.addCssRule("ha-table .dgrid-scrollbar-height","height: "+f+"px"),d.addCssRule("ha-table-virtual .dgrid-scrollbar-height","height: "+f+"px"),d.addCssRule("ha-table .dgrid-header-row","right: "+e+"px"),d.addCssRule("ha-table-virtual .dgrid-header-row","right: "+e+"px"),d.addCssRule("ha-table .dgrid-rtl-swap .dgrid-header-row","left: "+e+"px"),d.addCssRule("ha-table-virtual .dgrid-rtl-swap .dgrid-header-row","left: "+e+"px"))}})}),define("hui/table/TableBase",["dojo/_base/declare","dojo/_base/lang","dojo/when","dojo/on","dojo/aspect","dgrid/Grid","dgrid/Keyboard","./ColumnLocking","./ContentGroupPagination","./OnDemandContentGroups","dgrid/extensions/ColumnResizer","./ColumnHider","./RowReordering","./RowDeletion","./Editor","./RowStatusIndicator","./RowErrors","./BatchMode","./PersistentSort","./rendererFactoryFactory","../core/deviceUtils","./scopeListStyles"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){function v(a,b){b&&b.nodeType&&a.appendChild(b)}function w(a){var b=a.domNode&&a.domNode.parentElement&&a.domNode.parentElement.parentElement,c=b&&b.getBoundingClientRect();b&&!a._oldParentStyles&&(c.width&&c.height||(a._oldParentStyles={position:b.style.position,left:b.style.left,top:b.style.top,display:b.style.display,width:b.style.width,height:b.style.height},a._resizedParentElement=b,b.style.position="absolute",b.style.left="-5000px",b.style.top="-5000px",b.style.display="inline-block",b.style.width="2000px",b.style.height="20000px"))}function x(a){a.on("dgrid-sort",function(b){for(var c,d=b.sort[0],e=d?d.property:"",f=!!d&&d.descending,g=a.columns||[],h=0;h<g.length;++h)if(g[h].field===e){c=g[h].comparator;break}"function"==typeof c&&(b.preventDefault(),a.set("sort",function(b,d){return(f?-1:1)*c.call(a,b,d)}),a.updateSortArrow(b.sort,!0))})}f.extend({renderRow:function(a,b){var c,d=this.createRowCells("td",function(c,d){var e=a;d.get?e=d.get(a):"field"in d&&"_item"!==d.field&&(e=e[d.field]),this.print&&d.renderPrintCell?v(c,d.renderPrintCell(a,e,c,b)):d.renderCell?v(c,d.renderCell(a,e,c,b)):this._defaultRenderCell.call(d,a,e,c,b)}.bind(this),b&&b.subRows,a);return c=document.createElement("div"),c.setAttribute("role","row"),c.appendChild(d),c},configStructure:function(){var a=this.subRows,b=this._columns=this.columns;if(this.columns=b?b:{},a)for(var c=0;c<a.length;c++)a[c]=this._configColumns(c+"-",a[c]);else this.subRows=[this._configColumns("",b)]}});var y=a(null,{rendererFactory:null,_firstRun:!0,_totalRowClickListener:null,_totalRow:null,postMixInProperties:function(){this.inherited(arguments),this.totals&&this.set("totals",this.totals)},buildRendering:function(){this.inherited(arguments),this.headerNode.classList.add("ha-table-header"),this.contentNode.removeAttribute("role")},_setTotals:function(a){this.totals=a,this._renderTotalRow(a,"_totalRow")},postCreate:function(){this.inherited(arguments),this.on(["dgrid-select","dgrid-deselect","dgrid-refresh-complete","dgrid-error","dgrid-cellfocusin","dgrid-cellfocusout","dgrid-sort","dgrid-columnresize","dgrid-columnreorder","dgrid-columnstatechange","dgrid-datachange","dgrid-editor-show","dgrid-editor-hide"].join(","),function(a){var b=a.type.substr(6);"deselect"!==b&&"select"!==b||(b="batch-"+b),a.stopPropagation(),d.emit(this.domNode,b,a)}.bind(this));var a=function(){this._renderTotalRow(this.totals,"_totalRow")}.bind(this);this._listeners.push(e.after(this,"renderArray",function(a){return this.contentNode.removeAttribute("tabIndex"),a}),e.after(this,"renderQuery",function(a){return this._applyA11yRoles(),a}),e.after(this,"_hideColumn",a),e.after(this,"_showColumn",a),e.after(this,"_processScroll",this._publishResizeEvent.bind(this)),e.after(this,"_updateNavigation",this._publishResizeEvent.bind(this)),e.around(this,"renderHeader",function(a){return function(){var b=this,c=arguments;return this.rendererFactory?this.rendererFactory(this.renderMode,"header",this)(function(){return a.apply(b,c)}):a.call(this)}}),e.around(this,"renderRow",function(a){return function(b,c){var d=arguments,e=this;return this.rendererFactory?this.rendererFactory(this.renderMode,"row",this)(b,c,function(){return a.apply(e,d)}):a.apply(this,d)}})),x(this),this.rendererFactory=this.rendererFactory||t()},cleanup:function(){this._cleanup=!0,this.inherited(arguments),this._cleanup=!1},_publishResizeEvent:function(){d.emit(this.domNode,"table-resize",{cancelable:!1,bubbles:!0})},addRenderMode:function(){var a=Array.prototype.slice.call(arguments,0);this.rendererFactory?this.rendererFactory.addRenderMode.apply(this.rendererFactory,a):(this.rendererFactory=t(),this.rendererFactory.addRenderMode.apply(this.rendererFactory,a))},removeRenderMode:function(a){this.rendererFactory&&this.rendererFactory.removeRenderMode(a)},createRowCells:function(){var a=this.inherited(arguments);return Array.prototype.forEach.call(a.querySelectorAll("tr"),function(a){a.setAttribute("role","presentation")}),a},_setSort:function(){this._sortCalled=!0,this.inherited(arguments),this._setSortA11yAttributes()},_setSortA11yAttributes:function(){if(this.columns.length&&this.sort.length){var a={};this.sort.forEach&&this.sort.forEach(function(b){a[b.property]=b.descending?"descending":"ascending"}),this.columns.forEach(function(b){b.field in a?b.headerNode.setAttribute("aria-sort",a[b.field]):b.headerNode.classList.contains("dgrid-sortable")?b.headerNode.setAttribute("aria-sort","none"):b.headerNode.hasAttribute("aria-sort")&&b.headerNode.removeAttribute("aria-sort")})}},refresh:function(){if(this._started)return w(this),this.inherited(arguments)},resetParentStyles:function(){var a;if(this._resizedParentElement){for(a in this._oldParentStyles)this._resizedParentElement.style[a]=this._oldParentStyles[a];this._oldParentStyles=null,this._resizedParentElement=null}},reRenderRow:function(a,b){b=b||{};var c=this.row(a);if(c&&c.element){b.rows=this._rows;var d=c.element.parentElement,e=c.element.nextSibling;this.removeRow(c.element),this.insertRow(c.data,d,e,c.element.rowIndex,b)}},_setCompact:function(a){this.compact=a,this.compact?this.domNode.classList.add("compact"):this.domNode.classList.remove("compact")},_setAutoheight:function(a){this.domNode.classList[a?"add":"remove"]("dgrid-autoheight")},startup:function(){this.inherited(arguments),this._firstRun=!1},scrollTo:function(){if(!this._firstRun)return this.inherited(arguments)},_setRenderMode:function(a){this.rendererFactory&&a!==this.renderMode&&(this.rendererFactory(this.renderMode,"cleanup",this)(this),this.renderMode=a,this._pauseRendering(),this.set("columns",this.rendererFactory(this.renderMode,"columns",this)),this.set(this.rendererFactory(this.renderMode,"tableConfig",this)),this.rendererFactory(this.renderMode,"setup",this)(this),this._resumeRendering(),this.refresh())},_pauseRendering:function(){this._pausedRefresh=this.refresh,this.refresh=function(){},this._pausedRenderArray=this.renderArray,this.renderArray=function(){return this._rows},this._pausedRenderHeader=this.renderHeader,this.renderHeader=function(){}},_resumeRendering:function(){this._pausedRefresh&&(this.refresh=this._pausedRefresh,this._pausedRefresh=null),this._pausedRenderArray&&(this.renderArray=this._pausedRenderArray,this._pausedRenderArray=null),this._pausedRenderHeader&&(this.renderHeader=this._pausedRenderHeader,this._pausedRenderHeader=null)},_setRendererFactory:function(a){this.rendererFactory=a},row:function(){var a=this.inherited(arguments);return a&&a.element&&(a.flagNode=a.element.querySelector(".table-row-flag"),a.contentNode=a.element.querySelector(".table-row-content")),a},resize:function(){w(this),this.inherited(arguments),this.headerScrollNode&&(this.headerScrollNode.style.height=""),this._publishResizeEvent()},renderHeader:function(){this.inherited(arguments);var a=this.headerNode.firstChild,b=this.subRows.headerRows||this.subRows;b.forEach(function(a){a.forEach(function(a){a.headerNode.classList.contains("dgrid-sortable")&&a.headerNode.setAttribute("aria-sort","none")})}),this._sortListener&&this._sortListener.remove(),u.isMobile()||(this._sortListener=d(a,"click,keydown",this._onHeaderClick.bind(this)))},_onHeaderClick:function(a){if("click"===a.type||32===a.keyCode||13===a.keyCode){var b,c,e=a.target,f=this.sort[0],g=[];do if(e.sortable){c=e.field||e.columnId,g=[],f=this.sort[0],f&&f.property===c?g.push({property:c,descending:!f.descending}):g.push({property:c,descending:!1}),b={bubbles:!0,cancelable:!0,this:this,parentType:a.type,sort:g},d.emit(a.target,"dgrid-sort",b)&&(this._sortNode=e,this.set("sort",g));break}while((e=e.parentNode)&&e!==this.headerNode)}},removeRow:function(a){var b,c=a.offsetHeight;return a.destroy&&a.destroy(),b=this.inherited(arguments),d.emit(this.domNode,"row-remove",{height:c,bubbles:!0,cancelable:!1}),b},insertRow:function(){var a=this.inherited(arguments),b=a.offsetHeight;return d.emit(this.domNode,"row-insert",{height:b,bubbles:!0,cancelable:!1}),a.classList.add("ha-table-row"),a},updateSortArrow:function(){if(this._lastSortedArrow&&this._lastSortedArrow.parentNode.parentNode.classList.remove("sorted"),this.inherited(arguments),this._lastSortedArrow){var a=this._lastSortedArrow.parentNode;a.removeChild(this._lastSortedArrow),a.parentNode.classList.add("sorted"),a.firstChild.nextSibling?a.insertBefore(this._lastSortedArrow,a.firstChild.nextSibling):a.appendChild(this._lastSortedArrow)}},_convertColumns:function(a){if(Array.isArray(a))return a.map(function(a){return a.id=null,a});var b=Object.keys(a).map(function(b){var c=a[b];return"string"==typeof c?{field:b,label:c}:(c.field=b,c.id=null,c)});return b},_setColumns:function(a){if(a){this.__columns=a;var b=this._convertColumns(a);this._addCustomColumn&&this._addCustomColumn(b),this.inherited(arguments,[b]),this.headerNode.removeAttribute("tabIndex")}},_getColumns:function(){return this.__columns||this.inherited(arguments)},_renderTotalCell:function(a,b,c){var d=a[c.field]||"";b.textContent=d,c.className&&b.classList.add(c.className)},_checkForValidTotalTextCell:function(a,b,c,d){var e=this.columns[d].field;return e===this.batchField||e===this.categoryProperty?c:a[e]?null:c?c:b.getElementsByClassName("field-"+this.columns[d].field)[0]},_renderTotalRow:function(a,c,d){if(this[c]&&(this[c].parentNode&&this[c].parentNode.removeChild(this[c]),this[c]=null),a){var e,f,g,h,i,j,k,l,m,n,o,p=d?d.parentNode:this.contentNode,q=!1;for(g=this.createRowCells("td",b.hitch(this,"_renderTotalCell",a)),h=document.createElement("div"),h.setAttribute("role","row"),h.classList.add("total-row"),h.appendChild(g),this[c]=h,i=Array.isArray(this.columns)?new Array(this.columns.length):Object.keys(this.columns).sort(),f=i.length-1;f>=0;f--)n=void 0!==i[f]&&null!==i[f]?i[f]:f,this.columns.hasOwnProperty(n)&&(m=this.isColumnHidden&&this.isColumnHidden(this.columns[n].id),l=this.columns[n].field,a[l]&&!m&&(q=!0),e=m?e:this._checkForValidTotalTextCell(a,h,e,n),e||l===this.categoryProperty||l===this.batchField||m||(k=h.getElementsByClassName("field-"+l)[0]));return q?(e?(j=document.createElement("th"),j.innerHTML=e.innerHTML,j.setAttribute("scope","row"),j.setAttribute("role","rowheader"),j.textContent=this.totalText||"TOTAL",j.classList.add("total-text"),j.classList.add("right"),j.classList.add("dgrid-cell"),j.classList.add("ha-table-cell"),e.parentNode.replaceChild(j,e)):k&&(o=document.createElement("span"),o.classList.add("sr-only"),o.textContent=this.totalText,k.insertBefore(o,k.firstChild)),p&&p.parentNode&&p.insertBefore(h,d||null),h):null}},_setTotalText:function(a){this.totalText=a,this._totalRow&&this._renderTotalRow(this.totals,"_totalRow"),this.inherited(arguments)},_applyA11yRoles:function(){var a=this.contentNode.querySelectorAll(".dgrid-loading"),b=this.contentNode.querySelector(".dgrid-no-data");Array.prototype.slice.apply(a).forEach(function(a){a.setAttribute("role","alert")}),b&&b.setAttribute("role","gridcell")},resizeColumnWidth:function(a,b){var c=this.get("columns");if("string"==typeof a&&void 0===c[a])for(var d=0;d<c.length;d++)if(c[d].field===a){a=d;break}this.inherited(arguments,[a,b])}});return y.factory=function(b,c){b=b||{};var d=[g,k,l,o,y,p,q,r,m,n,s,h];return b.virtual?d.unshift(j):d.unshift(f,i),new(a(d))(b,c)},y}),define("hui/table/RowEditingRenderer",["./DefaultRenderer","object-utils/classes","dojo/aspect","../core/a11y"],function(a,b,c){function d(a){var b={};return a&&Object.keys(a).forEach(function(c){a[c].getValue&&(b[c]=a[c].getValue())}),b}function e(a,b){Object.keys(b).forEach(function(c){var d=a[c];d&&d.setValue&&d.setValue(b[c])})}function f(a,b,c,d){f.timeout&&(clearTimeout(f.timeout),f.timeout=null),f.timeout=setTimeout(function(){for(var a=document.activeElement,b=!1;a&&a!==document;){if(a===c){b=!0;break}a=a.target?a.target:a.parentElement}!b&&c.parentElement&&d.rowEditSaveHandler()},250)}function g(a,b,c,d){var e=a(),g=Array.prototype.slice.call(e.querySelectorAll("td"));return e.setAttribute("role","form"),g.forEach(function(a){var c=d.cell(a),g=c.column,h=b[g.field];h&&h.editor&&(h.editor.classList.add("row-editor"),h.column.label&&(h.editor.placeholder=h.column.label),a.innerHTML="",a.appendChild(h.editor)),Array.prototype.slice.call(a.children).forEach(function(a){a.addEventListener("blur",function(b){f(b,a,e,d)})})}),e}return b.extend(a,{constructor:function(){this._editableRowId=null,this._blurEventHandle=null,this._removeRowAspect=null,this._insertRowAspect=null},setup:function(a){var b=this;this._removeRowAspect=c.before(a,"removeRow",function(c){var e=a.row(c);return e.id===b._editableRowId?b._savedFieldValues=d(b._editableFields):b._savedFieldValues=null,arguments}),this._insertRowAspect=c.after(a,"insertRow",function(c){var d=a.row(c);return null!==b._savedFieldValues&&b._editableRowId===d.id&&e(b._editableFields,b._savedFieldValues),c})},cleanup:function(){this._cleanEventListeners(),this._editableRowId=null,this._editableFields=null,this._removeRowAspect.remove(),this._removeRowAspect=null,this._insertRowAspect.remove(),this._insertRowAspect=null},_cleanEventListeners:function(){null!==this._blurEventHandle&&(document.body.removeEventListener("mouseup",this._blurEventHandle),this._blurEventHandle=null)},setEditableRow:function(a,b,c){var d=this._editableRowId;this._editableRowId=b,this._editableFields=c,this._savedFieldValues=null,null!==d&&(this._cleanEventListeners(),a.reRenderRow(d)),null!==b&&a.reRenderRow(b)},row:function(a,b,c){var d,e=this.table,f=e.row(a);return f.id!==this._editableRowId?c():(d=g(c,this._editableFields,a,e),d.classList.add("editable-row"),null===this._blurEventHandle&&(this._blurEventHandle=function(a){for(var b=a.target,c=!1;b&&b!==document;){if(b.classList.contains("editable-row")){c=!0;break}b=b.target?b.target:b.parentElement}c||this.table.rowEditSaveHandler()}.bind(this),document.body.addEventListener("mouseup",this._blurEventHandle)),d)}})}),define("hui/table/RowExpansionRenderer",["./DefaultRenderer","object-utils/classes","../core/keys","../core/a11y","../core/utils"],function(a,b,c,d,e){function f(a,b){var c=!0;if(a&&a.target){for(var d=a.target;d&&"HA-TABLE"!==d.tagName;)d.classList.contains(b)?(c=!1,d=null):d=d.parentElement;"HA-CHECKBOX"!==a.target.tagName&&"HA-RADIO-BUTTON"!==a.target.tagName&&"INPUT"!==a.target.tagName&&"BUTTON"!==a.target.tagName&&"A"!==a.target.tagName||(c=!1)}return c}function g(a,b){b?a.querySelector(".dgrid-grid").classList.add("animate-height"):a.querySelector(".dgrid-grid").classList.remove("animate-height")}var h=0;return b.extend(a,{constructor:function(a){a=a||{},this.renderRowExpansionContent=a.renderRowExpansionContent||function(a){var b=this.table.ownerDocument.createElement("div"),c=this.table.store.getIdentity(a);return b.textContent="RowExpansion content for row with object id: "+c,b},this.activatorSelector=a.activatorSelector,this.expansionHeight=a.expansionHeight,this.manualActivation=a.manualActivation||!1,this.expansionClassName=a.expansionClassName,this.useFocusIndicator=a.useFocusIndicator||!1,this.focusIndicatorLabel=a.focusIndicatorLabel||"",this._expandedRows={},this.scrollingThreshold=a.scrollingThreshold||!1,this.autoResizeTable=a.autoResizeTable||!1,a.activatorSelector||(this.tableConfig={selectionMode:"none"})},_expansionMouseHandler:function(a){a.stopPropagation()},_toggleRowExpansion:function(a,b,c){var d,f,h=a.querySelector(".ha-table-row-expansion"),i=this.table.row(a);if(a.querySelector("."+this.batchClass)?(h.classList.add("batch-table-expansion"),h.classList.remove("no-batch-table-expansion")):(h.classList.add("no-batch-table-expansion"),h.classList.remove("batch-table-expansion")),"undefined"!=typeof b&&null!==b?d=!Boolean(b):(f=h.classList.contains("hidden")!==h.classList.contains("hide-expansion"),d=h.classList.contains("hidden")),!f)if(d){if(this._expandedRows[i.id]=!0,h.classList.remove("hidden"),this.useFocusIndicator&&a.classList.add("show-focus"),setTimeout(function(){h.classList.remove("hide-expansion"),this._handleFocusAndAriaAttributes(h,c,a)}.bind(this),0),this.scrollingThreshold!==!1){for(var j=a;j&&!j.classList.contains("dgrid-scroller");)j=j.parentElement;j&&setTimeout(function(){var b=j.getBoundingClientRect(),c=a.getBoundingClientRect();(b.bottom-c.top)/c.height<this.scrollingThreshold&&e.animateScrollTo(j,a.offsetTop,150)}.bind(this),50)}this.autoResizeTable&&setTimeout(function(){this.table._calculateInitialHeight({type:"row-expander-resize"})}.bind(this),0)}else delete this._expandedRows[i.id],h.classList.add("hide-expansion"),this.useFocusIndicator&&a.classList.remove("show-focus"),setTimeout(function(){h.classList.add("hidden")}.bind(this),350),this.autoResizeTable&&setTimeout(function(){g(this.table,!0),this.table._calculateInitialHeight({type:"row-expander-resize"}),setTimeout(function(){g(this.table,!1)}.bind(this),250)}.bind(this),250),this._handleFocusAndAriaAttributes(h,c,a)},_handleFocusAndAriaAttributes:function(a,b,c){a.classList.contains("hide-expansion")?(b.hasAttribute("tabindex")||(b.setAttribute("tabindex","-1"),b.addEventListener("blur",function a(){b.removeAttribute("tabindex"),b.removeEventListener("blur",a)})),b.focus(),b.setAttribute("aria-expanded",!1),c.classList.remove("highlighted-dgrid-row"),this.table.emit("expandable-row-close",{bubbles:!1,row:c})):(b.setAttribute("aria-expanded",!0),c.classList.add("highlighted-dgrid-row"),a.focus(),this.table.emit("expandable-row-show",{bubbles:!1,row:c}))},renderRowExpansion:function(a,b){var e,g,i=this.table,j=i.ownerDocument.createElement("div"),k=a.querySelector("table")||a,l=function(b,c){(this.activatorSelector||f(b,this.batchClass))&&this._toggleRowExpansion(a,c,k)}.bind(this),m=function(b,c){this._toggleRowExpansion(a,c,k)}.bind(this),n=this.renderRowExpansionContent(b,m),o=i.ownerDocument.createElement("button"),p=function(a){a.keyCode!==c.ENTER&&a.keyCode!==c.SPACEBAR||l(a)},q=a.querySelector("."+this.batchClass);if(this.expansionHeight&&(j.style.height=this.expansionHeight+"px"),o.className="hi hi-close close-expansion-button",o.addEventListener("click",m),o.setAttribute("aria-label","Close expanded row"),j.appendChild(n),this.manualActivation||(n.appendChild(o),j.setAttribute("tabindex","-1"),j.addEventListener("keydown",function(a){a.keyCode===c.ESCAPE&&l(),d.keepFocusInsideListener(a,j)}),j.addEventListener("click",this._expansionMouseHandler),j.addEventListener("mousedown",this._expansionMouseHandler),j.addEventListener("touchstart",this._expansionMouseHandler),this.activatorSelector&&(k=a.querySelector(this.activatorSelector)),g=j.id="table-row-expansion"+h++,k.setAttribute("aria-controls",g),k.setAttribute("aria-expanded",!1),k&&k.addEventListener&&(k.addEventListener("click",l),"BUTTON"!==k.tagName&&k.addEventListener("keydown",p)),e=function(){k.removeEventListener("click",l),k.removeEventListener("keydown",p)}),j.className="ha-table-row-expansion",b.id in this._expandedRows||(j.classList.add("hide-expansion"),j.classList.add("hidden")),this.expansionClassName&&j.classList.add(this.expansionClassName),q?j.classList.add("batch-table-expansion"):j.classList.add("no-batch-table-expansion"),this.useFocusIndicator){var r=document.createElement("button");r.className="focus-indicator hi hi-chevron-down",this.focusIndicatorLabel&&r.setAttribute("aria-label",this.focusIndicatorLabel),r.addEventListener("click",function(){this._toggleRowExpansion(a,!0,k)}.bind(this)),a.appendChild(r)}return a.appendChild(j),a.destroy=function(){e&&e(),n.destroy&&n.destroy()},a},row:function(a,b,c){var d=c();return this.renderRowExpansion(d,a,b)},setup:function(){this.batchClass="field-"+this.table.batchField}})}),define("hui/table/responsive/StackedRenderer",["object-utils/classes","../DefaultRenderer"],function(a,b){function c(a,b){return"ha-table-"+a.componentId+"-header-"+b}return a.extend(b,{constructor:function(a){this.tableConfig=a},row:function(a,b,d){var e=d();if(!e.classList.contains("category-row")){var f,g=document.createElement("td"),h=document.createElement("div"),i=document.createElement("div"),j=document.createElement("div"),k=this.table;i.classList.add("ha-stacked-left-column"),j.classList.add("ha-stacked-right-column"),g.classList.add("dgrid-cell"),Object.keys(this._matrix).forEach(function(a){var b,d,g,h,l,m=this._matrix[a];for(g=0;g<m.length;g++)d=m[g],b=document.createElement("div"),d&&(h=".field-"+d,l=e.querySelector(h),f=k.table.column(l),b.innerHTML=l.innerHTML,b.setAttribute("aria-describedby",c(k,f.id)),b.setAttribute("role","gridcell"),l.parentElement.removeChild(l)),"left"===a?i.appendChild(b):j.appendChild(b)},this),this._ignore.forEach(function(a){var b=e.querySelector(".field-"+a);b&&b.parentElement.removeChild(b)}),h.appendChild(i),h.appendChild(j),g.appendChild(h),e.querySelector("tr").appendChild(g)}return e},header:function(a){a();var b=this.table.querySelector(".ha-table-header"),d=this.table.querySelector(".batch-header-cell");if(b&&Array.prototype.slice.call(b.querySelectorAll("th.dgrid-cell"),0).forEach(function(a){
a.columnId&&(a.id=c(this.table,a.columnId))}.bind(this)),d){var e=d.querySelector("ha-checkbox"),f=this.table._toolbarNode,g=f.querySelector(".mobile-batch-header");g||(g=this.table.ownerDocument.createElement("div"),g.classList.add("mobile-batch-header"),g.classList.add("dgrid-selector"),g.addEventListener("click",function(a){a.column={row:null},a.element=g,this.table.table._handleSelectorClick(a)}.bind(this)),f.classList.add("mobile-batch-container"),f.appendChild(g)),g.innerHTML="",g.appendChild(e)}},setup:function(){function a(a){"left"===a.stackedColumn||"right"===a.stackedColumn?"number"==typeof a.stackedRow&&(d[a.stackedColumn][a.stackedRow]=a.field):a.field?e.push(a.field):"string"==typeof a&&e.push(a)}var b,c=this.table.columns,d={left:[],right:[]},e=[],f=!0;if(Array.isArray(c)?c.forEach(a):Object.keys(c).map(function(a){return"string"==typeof c[a]?a:c[a]}).forEach(a),0===d.left.length&&0===d.right.length)for(;d.right.length<3&&(b=e.shift());)d[f?"left":"right"].push(b),f=!f;this._matrix=d,this._ignore=e,this.table.classList.add("ha-stacked-table")},cleanup:function(){this.table.classList.remove("ha-stacked-table")}})}),define("hui/table/responsive/ColumnLockingRenderer",["object-utils/classes","../DefaultRenderer"],function(a,b){return a.extend(b,{constructor:function a(){a.super(this),this.tableConfig.lockedColumns=1},setup:function(){this.table.classList.add("ha-column-locking-table"),this.table.refresh()},cleanup:function(){this.table.classList.remove("ha-column-locking-table")}})}),define("hui/table/responsive/ResponsiveDefaultRenderer",["object-utils/classes","../DefaultRenderer"],function(a,b){return a.extend(b,{setup:function(){this.table.classList.add("ha-table-simple-scroll")},cleanup:function(){this.table.classList.remove("ha-table-simple-scroll")}})}),define("text!hui/table/table.html",[],function(){return'<template>\n    <div class="tablebar">\n        <div class="table-bar tablebar-default" role="menubar">\n            <div class="custom-node"></div>\n            <div class="filter-node"></div>\n            <div class="default-actions">\n                <span class="custom-action-node"></span>\n                <button name="edit">\n                    <span class="hi hi-edit" role="presentation" aria-hidden="true"></span>\n                    <span class="sr-only">{{editIconText}}</span>\n                </button>\n                <button name="print">\n                    <span class="hi hi-print" role="presentation" aria-hidden="true"></span>\n                    <span class="sr-only">{{printIconText}}</span>\n                </button>\n                <button aria-haspopup="true" name="export">\n                    <span class="hi hi-export" role="presentation" aria-hidden="true"></span>\n                    <span class="sr-only">{{exportIconText}}</span>\n                </button>\n                <button name="settings">\n                    <span class="hi hi-settings-o" role="presentation" aria-hidden="true"></span>\n                    <span class="sr-only">{{settingsIconText}}</span>\n                </button>\n                <ha-popover class="ha-table-settings-popover">\n                    <ha-popover-form>\n                        <section>\n                            <div class="section column-hider hidden">\n                                <h4>{{editColumnsText}}</h4>\n\n                                <div class="edit-columns"></div>\n                            </div>\n\n\n                            <div class="section">\n                                <div class="display-density hidden">\n                                    <h4>{{displayDensityText}}</h4>\n\n                                    <ha-checkbox name="compactCheckbox" label="{{compactText}}"></ha-checkbox>\n                                </div>\n\n                                <div class="custom"></div>\n\n                                <div class="rows-per-page">\n                                    <h4>{{rowsPerPageText}}</h4>\n\n                                    <ha-radio-button-group name="rowsPerPage">\n                                        <ha-radio-button label="50" value="50"></ha-radio-button>\n                                        <ha-radio-button label="150" value="150"></ha-radio-button>\n                                        <ha-radio-button label="300" value="300"></ha-radio-button>\n                                    </ha-radio-button-group>\n                                </div>\n                            </div>\n                        </section>\n                    </ha-popover-form>\n                </ha-popover>\n            </div>\n        </div>\n        <div class="table-bar tablebar-batch animate-hidden" role="menubar">\n            <div class="batch-node"></div>\n            <div class="batch-count" role="alert"></div>\n        </div>\n        <div class="table-bar tablebar-edit animate-hidden" role="menubar">\n            <div class="edit-actions">\n                <button name="cancel" class="ha-button edit-cancel">{{editModeCancelText}}</button>\n                <button name="save" class="ha-button edit-save">{{editModeSaveText}}</button>\n            </div>\n        </div>\n    </div>\n    <div class="grid-node"></div>\n    <span class="table-escape-node" tabindex="-1" aria-label="table escaped"></span>\n</template>\n'}),define("text!hui/table/print.html",[],function(){return'<!doctype html>\n<html lang="en">\n    <head>\n        <meta charset="UTF-8">\n        <title>Print table</title>\n        <style>{{{dgridCss}}}</style>\n        <style>\n            body {\n                font-family: {{{printListFontFamily}}};\n            }\n\n            .dgrid-header-row {\n                position: static;\n            }\n\n            .dgrid-scroller {\n                margin-top: 0;\n            }\n\n            .noprint,\n            .print .tablebar {\n                display: none;\n            }\n\n            .print .numeric,\n            .print .right {\n                text-align: right;\n            }\n        </style>\n        {{{customCss}}}\n    </head>\n\n    <body>\n        <h1>{{printListTitleText}}</h1>\n        <div class="subTitle">{{printListSubTitleText}}</div>\n        <div role="grid" class="dgrid dgrid-grid ui-widget grid-node dgrid-autoheight print">{{{gridContent}}}</div>\n\n        <script>\n            window.print();\n        </script>\n    </body>\n</html>\n'}),define("hui/table-column",["register-component/v2/register","register-component/v2/UIComponent","object-utils/classes"],function(a,b,c){function d(a,b){Object.defineProperty(a,b,{set:function(a){this["_"+b]=a,this.emit("column-change")},get:function(){return this["_"+b]}})}var e=c.createObject(b,{init:function a(){a.super(this),this.setupProperties({field:{type:String,default:""},label:{type:String,default:""},headerText:{type:String,default:""},id:{type:String,default:""},className:{type:String,default:""},sortable:{type:Boolean,default:!1},minWidth:{type:Number,default:40},width:{type:Number,default:null},resizable:{type:Boolean,default:!0},hidden:{type:Boolean,default:!1},unhidable:{type:Boolean,default:!1},"edit-on":{type:String,default:""},editable:{type:Boolean,default:!1}}),d(this,"renderCell"),d(this,"renderPrintCell"),d(this,"renderHeaderCell"),d(this,"formatter")},attributeChangedCallback:function a(b,c,d){a.super(this,b,c,d),this.emit("column-change",{attribute:b,value:d})},getColumnDefinition:function(){var a=this.editable,b=!(this.hasAttribute("sortable")&&"false"===this.getAttribute("sortable"));return{label:this.label,field:this.field,editor:a&&"text",editOn:a&&this["edit-on"],renderCell:this.renderCell,renderHeaderCell:this.renderHeaderCell,renderPrintCell:this.renderPrintCell,formatter:this.formatter,sortable:b}}});return a("ha-table-column",e)}),define("hui/table",["require","register-component/v2/register","register-component/v2/UIComponent","object-utils/classes","./core/utils","./core/a11y","./core/deviceUtils","./core/event","./helpers/string.helper","./table/TableBase","./table/RowEditingRenderer","./table/RowExpansionRenderer","./table/responsive/StackedRenderer","./table/responsive/ColumnLockingRenderer","./table/responsive/ResponsiveDefaultRenderer","register-component/template!./table/table.html","register-component/template!./table/print.html","register-component/template!dgrid/css/dgrid.css","./table-column","./radio-button","./radio-button-group","./checkbox","./drawer-large","./popover","./popover-form","./tags","./page-message"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){var s,t=e.YesNoType,u=["ha-checkbox","ha-radio-button-group","ha-select","ha-select-type-ahead","ha-text-field","ha-text-field-type-ahead"];return s=d.createObject(c,{init:function a(){a.super(this),this._filterNodes=null;var b={renderMode:"",selectionMode:"toggle",allowSelectAll:!0,loadingMessage:'<div class="infinite-loader"></div><span class="sr-only">Loading</span>',noDataMessage:'<p class="ha-table-no-data">No data available</p>',paginationText:"${start}-${end} of ${total}",paginationFirstText:"< First",paginationPreviousText:"Previous",paginationNextText:"Next",paginationLastText:"Last >",paginationAriaLabel:"table pagination",settingsApplyButtonLabel:"Apply",settingsResetButtonLabel:"Reset",settingsTitleText:"Table Settings",showMobileSortOptions:!0,mobileSortingText:"Sort by",mobileSortOrderText:"Sort order",mobileSortAscendingText:"Ascending",mobileSortDescendingText:"Descending",categoryProperty:"",expandAll:!1,allowBatchMode:!1,batchCellAriaLabel:"batch edit",batchSelectAriaLabel:"select this row",batchSelectAllAriaLabel:"Select all rows for editing",batchSelectAllHeaderAriaLabel:"Select rows for editing",allowRowReordering:!1,allowRowDeletion:!1,showHeader:!0,showFooter:!0,print:!1,totalText:"TOTAL",editMode:"",bufferRows:10,farOffRemoval:2e3,maxEmptySpace:1/0,maxRowsPerPage:250,minRowsPerPage:25,pagingDelay:15,pagingMethod:"debounce",queryRowsOverlap:0,deletionIconClass:"hi-delete"},c={};Object.keys(b).forEach(function(a){var d=b[a];c[a]={type:e.type(d),default:d,change:function(b){this._set(a,b)}}}),this.setupProperties(c),this.setupProperties({compact:{default:!1,type:t,change:function(a){this.classList[a?"add":"remove"]("compact"),this._compactCheckbox.checked=this.compact,this._saveSettings()}},rowsPerPage:{default:150,type:Number,change:function(a){this._set("rowsPerPage",a),this._rowsPerPageGroup.value=a,this._saveSettings()}},showTableBar:{type:t,default:!0,change:function(){this._refreshTableBar()}},filterType:{default:"",type:String,change:function(){this._renderFilter(),this._refreshTableBar()}},simpleFindPlaceholderText:{default:"",type:String},showEditMode:{default:!1,type:t,change:function(){this._refreshTableBar()}},editModeCancelText:{default:"Cancel",type:String},editModeSaveText:{default:"Save",type:String},showPrintList:{default:!1,type:t,change:function(){this._refreshTableBar()}},showExport:{default:!1,type:t,change:function(){this._refreshTableBar()}},showSettings:{default:!1,type:t,change:function(){this._refreshTableBar()}},showColumnHider:{default:!0,type:t,change:function(a){this._columnHiderNode&&(a?(this._updateColumnHider(),this._columnHiderNode.classList.remove("hidden")):this._columnHiderNode.classList.add("hidden"))}},showDisplayDensitySettings:{default:!1,type:t,change:function(a){this._displayDensityNode&&(a?this._displayDensityNode.classList.remove("hidden"):this._displayDensityNode.classList.add("hidden"))}},showRowsPerPageSettings:{default:!1,type:t,change:function(a){this._rowsPerPageNode&&(a?this._rowsPerPageNode.classList.remove("hidden"):this._rowsPerPageNode.classList.add("hidden"))}},printListAdditionalCSSFile:{default:"",type:String},printListFontFamily:{default:'"Helvetica Neue", Helvetica, Arial, sans-serif',type:String},printListTitleText:{default:"",type:String},printListSubTitleText:{default:"",type:String},batchItemSelectedText:{default:"{count} item selected",type:String},batchItemsSelectedText:{default:"{count} items selected",type:String},editIconText:{default:"Edit Table",type:String,change:function(a){this._setIconA11yText("edit",a)}},printIconText:{default:"Print Table",type:String,change:function(a){this._setIconA11yText("print",a)}},exportIconText:{default:"Export Table",type:String,change:function(a){this._setIconA11yText("export",a)}},settingsIconText:{default:"View Table Settings",type:String,change:function(a){this._setIconA11yText("settings",a)}},persistentId:{default:"",type:String,change:function(a){this._set("persistentId",a),this._loadSettings()}},userId:{default:"",type:String,change:function(a){this._set("userId",a),this._loadSettings()}},compactText:{default:"Compact",type:String,change:function(a){this._compactCheckbox&&(this._compactCheckbox.label=a)}},editColumnsText:{default:"Edit columns",type:String},displayDensityText:{default:"Display density",type:String,change:function(a){this._displayDensityNode.firstElementChild.textContent=a}},rowsPerPageText:{default:"Rows per page",type:String},autoheight:{type:t,default:!1,change:function(a){this._set("autoheight",a),this._setMaxHeight(a?null:this.maxHeight)}},maxHeight:{default:480,type:Number,change:function(a){this._setMaxHeight(a)}},editable:{default:!1,type:t,change:function(a){this._set("editable",a),this.setEditModeEnabled(a),this._callIfExists("_togglePaginationButtons",!a),a&&this.showAllHiddenColumns()}},lockedColumns:{default:0,type:Number,change:function(a){this._callIfExists("_setLockedColumns",a)}},activeFiltersText:{default:"Filters Active ({{count}})",type:String,change:function(){this._refreshFilterStatus()}},allowRowEditing:{default:!1,type:Boolean,change:function(a){a?this._enableRowEditing():this._disableRowEditing()}},rowEditSaveText:{default:"Save",type:String},rowEditTitle:{default:"",type:String},rowEditCancelText:{default:"Cancel",type:String}}),this.template=p,this._columns=this._getColumns(),this.originalColumns=e.clone(this._columns)},postRender:function(){f.addA11yFocus(this),this._toolbarNode=this.querySelector(".tablebar"),this._gridNode=this.querySelector(".grid-node"),this._settingsIconButton=this._toolbarNode.querySelector('button[name="settings"]'),this._editIconButton=this._toolbarNode.querySelector('button[name="edit"]'),this._printIconButton=this._toolbarNode.querySelector('button[name="print"]'),this._exportIconButton=this._toolbarNode.querySelector('button[name="export"]'),this._defaultNode=this.querySelector(".tablebar-default"),g.isMobile()?(this._settingsPopover=this._toolbarNode.querySelector(".ha-table-settings-popover"),this._settingsPopover&&(this._settingsPopover.parentNode.removeChild(this._settingsPopover),this._settingsPopover=null),this._settingsDrawer=this._renderSettingsDrawer()):(this._settingsPopover=this._toolbarNode.querySelector(".ha-table-settings-popover"),this._columnHiderNode=this._settingsPopover.querySelector(".column-hider"),this._displayDensityNode=this._settingsPopover.querySelector(".display-density"),this._compactCheckbox=this._displayDensityNode.querySelector("ha-checkbox[name=compactCheckbox]"),this._rowsPerPageNode=this._settingsPopover.querySelector(".rows-per-page"),this._rowsPerPageGroup=this._rowsPerPageNode.querySelector("ha-radio-button-group[name=rowsPerPage]"),this.otherSettingsNode=this._settingsPopover.querySelector(".custom"),h.on(this._settingsPopover,".edit-columns ha-checkbox:change",this._onChangeEditColumn.bind(this)),h.on(this._settingsPopover,".display-density ha-checkbox:change",this._onChangeDisplayDensity.bind(this)),h.on(this._settingsPopover,".rows-per-page ha-radio-button-group:change",this._onChangeRowsPerPage.bind(this))),this.listenTo(this._defaultNode,"button:click",function(a){var b=a.target.name,c=this["_onClick"+b.charAt(0).toUpperCase()+b.slice(1)];c&&c.call(this,a)}.bind(this)),this.table=this._createGrid(),this.on("table-resize",this._calculateInitialHeight.bind(this)),this._batchNode=this.querySelector(".batch-node"),this._batchBarNode=this.querySelector(".tablebar-batch"),this._batchCountNode=this.querySelector(".batch-count"),this._editNode=this.querySelector(".tablebar-edit"),this._filterNode=this.querySelector(".filter-node"),this.tableBarCustomNode=this.querySelector(".custom-node"),this.tableBarCustomActionNode=this.querySelector(".custom-action-node"),this._batchModeEnabled=!1,this.on("ha-table-column:column-change",function(){this.columns=this._getColumns()}.bind(this)),this.on("batch-select",function(){this._checkBatchMode(!0)}.bind(this)),this.on("batch-deselect",function(a){this._checkBatchMode(),this.clearErrors(a.rows.map(function(a){return a.id}))}.bind(this)),this._calculateInitialHeight(),this.on("row-remove",this._adjustHeight.bind(this,!1)),this.on("row-insert",this._adjustHeight.bind(this,!0)),this.on("refresh-complete",function(){this._refreshTableBar(),this.table.gotoPage?this.table.resetParentStyles():this._calculateInitialHeight()}.bind(this)),this.listenTo(this.querySelector(".edit-cancel"),"click",this.onEditCancel.bind(this)),this.listenTo(this.querySelector(".edit-save"),"click",this.onEditSave.bind(this)),this._loadSettings(),this._addRenderModes(),this._rowExpansion=!0,this._rowExpansionRenderer=null},detachedCallback:function(){var a=this._settingsPopover||this._settingsDrawer;a.parentElement&&a.parentElement.removeChild(a)},_setMaxHeight:function(a){var b=this._get("domNode");a&&(a+="px"),b&&(b.style.maxHeight=a)},_calculateInitialHeight:function(a){if(!this._get("_isProcessingScroll")||!a||"table-resize"!==a.type){var b=this._get("domNode"),c=0,d=124;b&&(this.table.headerNode&&(c+=this.table.headerNode.offsetHeight),this.table.footerNode&&(c+=this.table.footerNode.offsetHeight),Array.prototype.forEach.call(this.querySelectorAll(".dgrid-row"),function(a){c+=a.offsetHeight}),this._lastNoDataHeight=this.table.noDataNode?this.table.noDataNode.offsetHeight:null,this._lastNoDataHeight&&(c+=this._lastNoDataHeight+35),c=Math.max(d,c),b.style.height=c+"px"),this.table.resetParentStyles()}},_adjustHeight:function(a,b){if(!this._get("_cleanup")&&!this._get("_isProcessingScroll")){var c=this._get("domNode"),d=c.style.height,e=b.height,f=Number(d.substring(0,d.length-2)),g=a?f+e:f-e;a?this._lastNoDataHeight&&(g-=this._lastNoDataHeight,this._lastNoDataHeight=null):this.table.noDataNode&&(this._lastNoDataHeight=this.table.noDataNode.offsetHeight,g+=this._lastNoDataHeight),isNaN(g)||(c.style.height=g+"px")}},set query(a){this._query=a,this._set("collection",a?this._collection.filter(a):this._collection),this.refresh()},get query(){return this._query},_checkBatchMode:function(a){var b=Object.keys(this.table.selection).reduce(function(a,b){return a+(this.table.selection[b]?1:0)}.bind(this),0),c=(1===b?this.batchItemSelectedText:this.batchItemsSelectedText).replace(/\{count\}/,b);this._batchCountNode.textContent=c,a&&!this._batchModeEnabled?this.setBatchModeActive(!0):!b&&this._batchModeEnabled&&this.setBatchModeActive(!1),this._batchModeEnabled=!!b},attachedCallback:function(){this.table&&!this.table._started&&this._callIfExists("startup")},_createGrid:function(){return j.factory({table:this,virtual:!1,columns:this._columns},this._gridNode)},_setIconA11yText:function(a,b){var c=this.querySelector(".hi-"+a+" + .icon-text");c&&(c.textContent=b)},_set:function(a,b){return this._callIfExists("set",a,b)},_get:function(a){return this._callIfExists("get",a)},_callIfExists:function(a){var b=Array.prototype.slice.call(arguments,1);return this.table&&this.table[a]&&this.table[a].apply(this.table,b)},_getColumns:function(){var a=Array.prototype.map.call(this.querySelectorAll("ha-table-column"),function(a){return a.getColumnDefinition()}),b=a.length?a:this.columns;return b},addRenderMode:function(){this.table.addRenderMode.apply(this.table,arguments)},removeRenderMode:function(a){this._callIfExists("removeRenderMode",a)},set columns(a){this.renderMode&&this.rendererFactory&&this.rendererFactory(this.renderMode,"cleanup",this.table)(this.table),this._columns=a,this.originalColumns=e.clone(a,this.table?[this.table]:[]),this._set("columns",a),this._loadSettings(),this._updateColumnHider(),this.updateFactorySettings(),this.renderMode&&this.rendererFactory&&this.rendererFactory(this.renderMode,"setup",this.table)(this.table)},get columns(){return this._get("columns")||this._columns},set sort(a){this._set("sort",a)},get sort(){return this._get("sort")},get renderModes(){return this._get("renderModes")},set editableFields(a){this._set("editableFields",a)},get editableFields(){return this._get("editableFields")},set exportButton(a){this._exportIconButton.parentNode.replaceChild(a,this._exportIconButton),this._exportIconButton=a},get exportButton(){return this._editIconButton},get hasToolbarContent(){return Boolean(this.filterType||this.showEditMode||this.allowBatchMode||this.showPrintList||this.showExport||this.showSettings||this.otherSettingsNode)},_shouldShowToolbar:function(){return this.showTableBar&&!!(this.filterType||this.showEditMode||this.allowBatchMode||this.showPrintList||this.showExport||this.showSettings)},set rowStatus(a){this._set("rowStatus",a)},get rowStatus(){return this._get("rowStatus")},set collection(a){this._collection=a,this._set("collection",a)},get collection(){return this._get("collection")},_onClickFilter:function(){var a=this.filterNodes[0];a.show({detail:this.query})},_renderFilter:function(){var a,b,c,d,e,f,h,i,j=this.ownerDocument,k=this._filterNode,l=this.filterNodes;k.innerHTML="",k.classList.remove("mobile-filter-bar"),this._tags=null,"complex"===this.filterType?(a=j.createElement("button"),b=j.createElement("span"),c=j.createElement("span"),b.classList.add("hi"),b.classList.add("hi-filter"),b.setAttribute("aria-hidden",!0),c.classList.add("sr-only"),c.textContent="Filter",a.name="filter",a.appendChild(b),a.appendChild(c),k.appendChild(a),g.isHandheld()?(d=this._filterStatus=j.createElement("button"),d.classList.add("filter-status"),d.style.display="none",d.addEventListener("click",this._onClickFilter.bind(this))):(d=this._tags=j.createElement("ha-tags"),d.maxDisplay=3),k.appendChild(d),l.length>0&&(g.isHandheld()&&"HA-POPOVER"===l[0].tagName?(l[0]=this._buildDrawerFromPopover(l[0]),l[0].on("close",function(){a.focus()})):l[0].target=a)):"simple"===this.filterType&&g.isHandheld()&&l[0]&&"HA-TEXT-FIELD"===l[0].tagName?(e=l[0],f=j.createElement("div"),f.className="mobile-table-filter table-bar tablebar-default",h=j.createElement("button"),h.textContent="Cancel",h.addEventListener("click",function(){f.parentNode.insertBefore(i,f),f.classList.remove("visible"),this._defaultNode=i,setTimeout(function(){f.parentNode.removeChild(f),e.value="",e.emit("change")},300)}.bind(this)),a=j.createElement("button"),b=j.createElement("span"),b.classList.add("hi"),b.classList.add("hi-search"),a.appendChild(b),a.setAttribute("aria-label","Filter"),f.appendChild(e),f.appendChild(h),a.addEventListener("click",function(){i=k.parentElement,i.parentElement.appendChild(f),this._defaultNode=f,setTimeout(function(){f.classList.add("visible"),setTimeout(function(){i.parentElement.removeChild(i),e.focus()},300)},0)}.bind(this)),e.on("input",function(){e.emit("change")}),k.classList.add("mobile-filter-bar"),k.appendChild(a),l=[],e.classList.add("mobile-text-field-force-open")):"simple"===this.filterType&&g.isHandheld()&&k.classList.add("mobile-filter-bar"),l.forEach(function(a){k.appendChild(a)})},filter:function(a,b){a=a||{};var c=this._tags,d=this._filterStatus;this.query=a,c?c.tags=Object.keys(a).map(function(c){var d=document.createElement("ha-tag");return d.label=b?b[c]||a[c]:a[c],d.value=c,d}):d&&this._refreshFilterStatus()},_refreshFilterStatus:function(){var a=Object.keys(this.query||{}).length,b=this._filterStatus;b&&(a?(b.style.display="inline-block",b.textContent=i.replaceKeys(this.activeFiltersText,{count:a})):b.style.display="none")},set filterNodes(a){if(this.filterType||(this.filterType="simple"),a.length&&"complex"===this.filterType){if(a.length>1)throw new Error('filterNodes: the array can only be of length 1 when the filterType is "complex"');if("ha-popover"!==a[0].tagName.toLowerCase())throw new Error('filterNodes: This property only accepts ha-popover elements when the filterType is "complex"')}else a.forEach(function(a){var b=a.nodeName.toLowerCase();if("ha-select"!==b&&"ha-text-field"!==b)throw new Error('filterNodes: This property only accepts ha-select and ha-text-field elements when the filterType is "simple"')});this._filterNodes=a,this._renderFilter()},get filterNodes(){var a=this._filterNodes;return a||(a=this._filterNodes=[]),a},get selection(){return this._get("selection")},set store(a){this._set("collection",a)},get store(){return this._get("collection")},set footerTotalNode(a){this._set("footerTotalNode",a)},get footerTotalNode(){return this._get("footerTotalNode")},set batchNodes(a){var b=this._batchNode;b.innerHTML="",a.forEach(function(a){b.appendChild(a)})},get batchNodes(){return Array.prototype.slice.call(this._batchNode.childNodes)},get batchField(){return this._get("batchField")},get rowReorderField(){return this._get("rowReorderField")},set rendererFactory(a){this._set("rendererFactory",a),this._addRenderModes()},get rendererFactory(){return this._get("rendererFactory")},set totals(a){this._set("totals",a)},get totals(){return this._get("totals")},set categoryTotals(a){this._set("categoryTotals",a)},get categoryTotals(){return this._get("categoryTotals")},set responsiveLayout(a){this._responsiveLayout=a,g.isHandheld()&&(this.cancelRowEdit(),this.renderMode=this._responsiveLayout?a+"Renderer":"default",this._prepareRowEditor())},get responsiveLayout(){return this._responsiveLayout},cell:function(a){return this._callIfExists("cell",a)},row:function(a){return this._callIfExists("row",a)},gotoPage:function(a){return this._callIfExists("gotoPage",a)},get _total(){return this._get("_total")},setError:function(a,b){return this._callIfExists("setError",a,b)},clearError:function(a){return this._callIfExists("clearError",a)},setErrors:function(a){return this._callIfExists("setErrors",a)},clearErrors:function(a){return this._callIfExists("clearErrors",a)},reRenderRow:function(a,b){return this._callIfExists("reRenderRow",a,b)},clearSelection:function(){this._callIfExists("clearSelection")},deselect:function(a,b){this._callIfExists("deselect",a,b)},select:function(a,b){this.allowBatchMode&&this._callIfExists("select",a,b)},selectAll:function(){this.allowBatchMode&&this._callIfExists("selectAll")},refresh:function(){this._callIfExists("refresh"),this._refreshTableBar()},resize:function(){return this._callIfExists("resize")},resizeColumnWidth:function(a,b){return this._callIfExists("resizeColumnWidth",a,b)},_refreshTableBar:function(){var a=this.editMode&&"specific"===this.editMode;this.showTableBar&&this.hasToolbarContent?(this._toolbarNode.classList.remove("hidden"),this.showSettings?(this._settingsIconButton.classList.remove("hidden"),this._updateColumnHider(),this._loadSettings()):this._settingsIconButton.classList.add("hidden"),this.showExport&&this._total?this._exportIconButton.classList.remove("hidden"):this._exportIconButton.classList.add("hidden"),this.showEditMode&&this._total?a?this._changeSpecificEdit():this._editIconButton.classList.remove("hidden"):a?this._changeSpecificEdit(!0):this._editIconButton.classList.add("hidden"),this.showPrintList&&this._total?this._printIconButton.classList.remove("hidden"):this._printIconButton.classList.add("hidden")):this._toolbarNode.classList.add("hidden")},_loadSettings:function(){if(this.showSettings){var a,b,c=this._rowsPerPageGroup;if(this._loadingSettings=!0,c&&(c.value=this.rowsPerPage),this.userId&&this.persistentId&&window.localStorage){if(a="table-"+this.userId+this.persistentId+"-settings",b=JSON.parse(window.localStorage.getItem(a)),!b)return void(this._loadingSettings=!1);b.compact&&(this.compact=!0,this._compactCheckbox.checked=!0),b.rowsPerPage&&(this.rowsPerPage=b.rowsPerPage),b.columns&&(Object.keys(this.table.columns).forEach(function(a){var c=this.table.columns[a];b.columns[c.field]&&(b.columns[c.field].hidden&&(c.hidden=!0,this.table._updateColumnHiddenState(c.id,!0)),b.columns[c.field].unhidable&&(c.unhidable=!0))},this),this._updateColumnHider())}this._loadingSettings=!1}},_saveSettings:function(){if(!this._loadingSettings&&window.localStorage&&this.userId&&this.persistentId){var a="table-"+this.userId+this.persistentId+"-settings",b=this._get("columns"),c={compact:this.compact,rowsPerPage:this.rowsPerPage,columns:{}};Object.keys(b).forEach(function(a){var d=b[a];d.hidden&&(c.columns[d.field]={hidden:!0}),d.unhidable&&(c.columns[d.field]||(c.columns[d.field]={}),c.columns[d.field].unhidable=!0)},this),window.localStorage.setItem(a,JSON.stringify(c))}},getAvailableEditableFields:function(){return this._callIfExists("getAvailableEditableFields")},get dirty(){return this._get("dirty")},get fields(){var a=this.columns;return Array.isArray(a)?a.map(function(a){return a.field}):Object.keys(a)},showAllHiddenColumns:function(){var a=this.columns,b=Array.isArray(a)?a.map(function(a){return a.field}):Object.keys(a);b.forEach(function(a,b){this._callIfExists("toggleColumnHiddenState",""+b,!1)}.bind(this))},_changeSpecificEdit:function(a){function b(a){var b=a.target.selectedItem.value;c.editableFields=[b],c.editable=!0}var c=this;return a?void(this.editMenu&&(this._toolbarNode.removeChild(this.editMenu),this.editMenu.removeEventListener(b))):void(this.editMenu||(this.editMenu=document.createElement("ha-menu-button"),this.editMenu.label="Edit Specific Field",this.editMenu.classList.add("specific-edit"),this.editMenu.icon="hi-edit",this.editMenu.items=this.getAvailableEditableFields().map(function(a){var b=document.createElement("ha-item"),d=c.columns[a].label;return b.label=d,b.value=a,b}),this.editMenu.addEventListener("select",b),this._editIconButton.parentNode.insertBefore(this.editMenu,this._editIconButton)))},_onClickEdit:function(a){a.editableFields="custom"===this.editMode?this.editableFields:this.getAvailableEditableFields(),this.onClickEdit(a)},onClickEdit:function(a){this.editable=!0},onEditCancel:function(){this.emit("edit-cancel"),this.revert(),this.editable=!1},onEditSave:function(){this.emit("edit-save",{changed:this.dirty})},save:function(){this._callIfExists("save")},revert:function(){this._callIfExists("revert")},setEditModeEnabled:function(a){this._defaultNode.classList[a?"add":"remove"]("animate-hidden"),this._defaultNode[a?"setAttribute":"removeAttribute"]("aria-hidden",!0),this._editNode.classList[a?"remove":"add"]("animate-hidden"),this._editNode[a?"removeAttribute":"setAttribute"]("aria-hidden",!0)},updateFactorySettings:function(){this.rendererFactory&&this.rendererFactory.resetConfig(this.table)},_addRenderModes:function(){if(this._rowEditingRenderer=new k,this.addRenderMode("rowEdit",this._rowEditingRenderer),this._rowExpansionTableRenderer=new l({renderRowExpansionContent:function(a){var b=this.row(a);return this._lastEditRow===b.id?this._rowExpansionRenderer?(this._cachedRowExpansion||(this._cachedRowExpansion=this._rowExpansionRenderer(b.id,function(){this.cancelRowEdit()}.bind(this))),this._cachedRowExpansion):this._createMobileRowExpansion():this.ownerDocument.createElement("div")}.bind(this),manualActivation:!0,expansionClassName:"row-edit-expansion",useFocusIndicator:!0,scrollingThreshold:1,autoResizeTable:!0,focusIndicatorLabel:this.rowEditCancelText}),this.addRenderMode("rowEditExpansion",this._rowExpansionTableRenderer),this.addRenderMode("stackedRenderer",new m,this._rowExpansionTableRenderer),this.addRenderMode("columnLockingRenderer",new n,this._rowExpansionTableRenderer),g.isHandheld()&&this.addRenderMode("default",new o,this._rowExpansionTableRenderer),this.renderMode){var a=this.renderMode;this.renderMode="",this.renderMode=a}else this.renderMode="default"},_onClickSettings:function(){var a=this._settingsPopover||this._settingsDrawer;a.classList.contains("visible")?a.close():(g.isMobile()&&(this._buildMobileSortOptions(),
this._storeDefaultSettings(),this._backupSettings()),a.show())},_getFormElements:function(a){return a.querySelectorAll(u.join(","))},_getSettings:function(){var a=this._settingsDrawer||this._settingsPopover,b={};return Array.prototype.forEach.call(this._getFormElements(a),function(a){var c=a.name||a.label;c&&(b[c]="checked"in a?a.checked:a.value)}),b},_storeDefaultSettings:function(){this._defaultSettings||(this._defaultSettings=this._getSettings())},_backupSettings:function(){this._backedupSettings=this._getSettings()},_onChangeDisplayDensity:function(a){this.compact=a.target.checked,this.table.resize()},_onChangeEditColumn:function(a){this.table._updateColumnHiddenState(a.target.value,!a.target.checked),this._saveSettings()},_onChangeRowsPerPage:function(a){this.rowsPerPage=parseInt(a.target.value,10),this._saveSettings()},_onClickPrint:function(){var a=window.open();this._renderPrintPage(a)},_renderPrintPage:function(b){var c,d=b.document,f={currentPath:window.location.href.substr(0,window.location.href.lastIndexOf("/")),customCss:this.printListAdditionalCSSFile,dgridCss:r,printListTitleText:this.printListTitleText,printListSubTitleText:this.printListSubTitleText,printListFontFamily:this.printListFontFamily};f.customCss&&("http"!==f.customCss.substr(0,4).toLowerCase()&&(f.customCss=f.currentPath+"/"+a.toUrl(f.customCss)),f.customCss='<link rel="stylesheet" href="'+f.customCss+'">'),a(["./table-virtual"],function(){var a=document.createElement("div");a.style.position="absolute",a.style.left="-5000px",a.style.top="-5000px",a.style.display="inline-block",a.style.width="2000px",a.style.height="20000px",c=this.ownerDocument.createElement("ha-table-virtual"),c.print=!0,c.allowBatchMode=!1,c.compact=this.compact,c.showTableBar=!1,c.columns=e.clone(this.originalColumns,[this]),c.collection=this.collection,this.printRenderer&&(c.addRenderMode("print",this.printRenderer),c.renderMode="print"),this.ownerDocument.body.appendChild(a),a.appendChild(c),c.table.minRowsPerPage=1/0,c.autoheight=!0,c.sort=this.sort,this.table._columnHiderRules&&Object.keys(this.table._columnHiderRules).forEach(function(a){c.table._updateColumnHiddenState(a,!0)}),c.on("refresh-complete",function(){c&&(c.table.bodyNode.style.marginTop="",f.gridContent=c.table.domNode.innerHTML,d.open(),d.write(q(f)),d.close(),c.ownerDocument.body.removeChild(a),c=null)})}.bind(this))},_renderSettingsDrawer:function(){var a=this.ownerDocument.createElement("ha-drawer-large"),b=this.ownerDocument.createElement("div"),c=this.ownerDocument.createElement("button"),d=this.ownerDocument.createElement("button");return a.classList.add("table-settings"),a.backdrop=!0,a.titleText=this.settingsTitleText,a.footer=this.ownerDocument.createElement("div"),a.footer[0].style.position="relative",c.className="ha-button ha-button-primary",c.textContent=this.settingsApplyButtonLabel,a.footer[0].appendChild(c),d.className="ha-button ha-button-secondary",d.textContent=this.settingsResetButtonLabel,a.footer[0].appendChild(d),this._sortNode=this.ownerDocument.createElement("div"),this._sortNode.classList.add("mobile-sort-options"),this._sortNode.appendChild(this.ownerDocument.createElement("h4")),this._sortNode.lastChild.textContent=this.mobileSortingText,this._sortOptionsNode=this.ownerDocument.createElement("div"),this._sortNode.appendChild(this._sortOptionsNode),this._sortNode.appendChild(this.ownerDocument.createElement("div")),this._sortNode.lastChild.textContent=".",this._sortNode.lastChild.classList.add("clearfix"),b.appendChild(this._sortNode),this._columnHiderNode=this.ownerDocument.createElement("div"),this._columnHiderNode.classList.add("column-hider"),this._columnHiderNode.appendChild(this.ownerDocument.createElement("h4")),this._columnHiderNode.lastChild.textContent=this.editColumnsText,this._columnHiderNode.appendChild(this.ownerDocument.createElement("div")),this._columnHiderNode.lastChild.className="edit-columns",b.appendChild(this._columnHiderNode),this._displayDensityNode=this.ownerDocument.createElement("div"),this._displayDensityNode.classList.add("display-density"),this._displayDensityNode.appendChild(this.ownerDocument.createElement("h4")),this._displayDensityNode.lastChild.textContent=this.displayDensityText,this._compactCheckbox=this.ownerDocument.createElement("ha-checkbox"),this._compactCheckbox.name="compactCheckbox",this._compactCheckbox.label=this.compactText,this._displayDensityNode.appendChild(this._compactCheckbox),b.appendChild(this._displayDensityNode),this.otherSettingsNode=this.ownerDocument.createElement("div"),this.otherSettingsNode.className="custom",b.appendChild(this.otherSettingsNode),this._rowsPerPageNode=this.ownerDocument.createElement("div"),this._rowsPerPageNode.classList.add("rows-per-page"),this._rowsPerPageNode.appendChild(this.ownerDocument.createElement("h4")),this._rowsPerPageNode.lastChild.textContent=this.rowsPerPageText,this._rowsPerPageGroup=this.ownerDocument.createElement("ha-radio-button-group"),this._rowsPerPageGroup.name="rowsPerPage",this._rowsPerPageGroup.radios=["50","150","300"].map(function(a){var b=this.ownerDocument.createElement("ha-radio-button");return b.label=a,b.value=a,b}.bind(this)),this._rowsPerPageNode.appendChild(this._rowsPerPageGroup),this._shouldShowPaginationSettings()&&b.appendChild(this._rowsPerPageNode),this.listenTo(c,"click",function(){this._applySettings(),this._settingsDrawer.close()}.bind(this)),this.listenTo(d,"click",function(){this._resetSettings()}.bind(this)),a.section=b,a},_applySettings:function(){Array.prototype.forEach.call(this._columnHiderNode.querySelectorAll("ha-checkbox"),function(a){var b=a.name||a.label;a.checked!==this._backedupSettings[b]&&this._onChangeEditColumn({target:a})}.bind(this)),this._compactCheckbox.checked!==this._backedupSettings[this._compactCheckbox.name]&&this._onChangeDisplayDensity({target:this._compactCheckbox}),this._shouldShowPaginationSettings()&&this._rowsPerPageGroup.value!==this._backedupSettings[this._rowsPerPageGroup.name]&&this._onChangeRowsPerPage({target:this._rowsPerPageGroup});var a,b;Array.prototype.forEach.call(this._sortNode.querySelectorAll("ha-radio-button"),function(c){"sort"===c.name&&c.checked?a=c.value:"sortDir"===c.name&&c.checked&&(b="desc"===c.value)}),void 0!==a?this.table.set("sort",[{property:a,descending:void 0!==b&&b}]):this.table.set("sort",[])},_resetSettings:function(){var a,b;for(a in this._defaultSettings)b=this._settingsDrawer.querySelector('[name="'+a+'"]'),b||(b=this._settingsDrawer.querySelector('[label="'+a+'"]')),b&&("checked"in b?b.checked=this._defaultSettings[a]:"HA-RADIO-BUTTON-GROUP"!==b.tagName||this._defaultSettings[a]?b.value=this._defaultSettings[a]:Array.prototype.forEach.call(b.querySelectorAll("ha-radio-button"),function(a){a.checked=!1}))},_shouldShowPaginationSettings:function(){return!0},_onClickExport:function(a){a.table=this,this.emit("export",a)},setBatchModeActive:function(a){a?(this._defaultNode.classList.add("animate-hidden"),this._defaultNode.setAttribute("aria-hidden",!0),this._batchBarNode.classList.remove("animate-hidden"),this._batchBarNode.removeAttribute("aria-hidden")):(this._defaultNode.removeAttribute("aria-hidden"),this._defaultNode.classList.remove("animate-hidden"),this._batchBarNode.setAttribute("aria-hidden",!0),this._batchBarNode.classList.add("animate-hidden")),this._set("batchModeActive",a)},_updateColumnHider:function(){if(this.showSettings&&this.showColumnHider){var a,b=this._columnHiderNode.querySelector(".edit-columns"),c=Object.keys(this.table.columns),d=g.isMobile()?1:Math.ceil(c.length/10),e=!1;b.innerHTML="","WebkitColumnCount"in this.ownerDocument.documentElement.style?b.style.WebkitColumnCount=d:"MozColumnCount"in this.ownerDocument.documentElement.style&&(b.style.MozColumnCount=d),b.style.columnCount=d,c.forEach(function(c){var d=this.table.columns[c];d.unhidable||(d.hidden&&this.table._hideColumn(d.id),e=!0,a=this.ownerDocument.createElement("ha-checkbox"),a.label=d.label,a.value=d.id,a.name="hide-"+d.id,"hidden"in d?a.checked=!d.hidden:a.checked=!0,b.appendChild(a))},this),e?this._columnHiderNode.classList.remove("hidden"):this._columnHiderNode.classList.add("hidden")}},_buildDrawerFromPopover:function(a){function b(a,b){b&&("length"in b?Array.prototype.slice.call(b).forEach(function(b){a.appendChild(b)}):a.appendChild(b))}if(a._convertedDrawer)return a._convertedDrawer;var c,d=this.ownerDocument.createElement("ha-drawer-large"),e=this.ownerDocument.createElement("section"),f=this.ownerDocument.createElement("footer"),g=a.querySelector("ha-popover-form");return g?(b(e,g.section),b(f,g.footer)):b(e,a.children),[".ha-button-primary",".ha-button-secondary"].forEach(function(b){null===f.querySelector(b)&&[a,e].forEach(function(a){c=a.querySelector(b),c&&(f.appendChild(c),c.addEventListener("click",function(){d.close()}))})}),d.backdrop=!0,d.classList.add("two-button"),d.titleText="Filters",e&&(d.section=e),f&&(d.footer=f),a._convertedDrawer=d,d},_shouldEditRow:function(a){var b=!0;return a&&a.target&&("HA-CHECKBOX"!==a.target.tagName&&"HA-RADIO-BUTTON"!==a.target.tagName&&"INPUT"!==a.target.tagName&&"BUTTON"!==a.target.tagName&&"A"!==a.target.tagName||(b=!1)),b},set rowExpansion(a){this.allowRowEditing&&this.cancelRowEdit(),this._rowExpansion=a,this.allowRowEditing&&this._prepareRowEditor()},get rowExpansion(){return this._rowExpansion},set rowExpansionRenderer(a){this.allowRowEditing&&this.cancelRowEdit(),this._rowExpansionRenderer=a},get rowExpansionRenderer(){return this._rowExpansionRenderer},_enableRowEditing:function(){this._callIfExists("_togglePaginationButtons",!1),this._lastEditRow=null,this._rowFocusEventHandle=function(a){if(this._shouldEditRow(a)){var b=this.cell(a),c=b?b.row:null;c&&b&&null===this._lastEditRow&&(a.stopPropagation(),a.preventDefault(),this._lastEditRow=c.id,this._showRowEditor(c.id))}}.bind(this),this._rowEditOldSelectionMode=this.selectionMode,this.selectionMode="none",this.on("click",this._rowFocusEventHandle),this._prepareRowEditor(),this._storeUpdateHandle=this.table.collection.on("add, delete",function(){this.cancelRowEdit()}.bind(this))},_disableRowEditing:function(){this._callIfExists("_togglePaginationButtons",!0),this.cancelRowEdit(),this.selectionMode=this._rowEditOldSelectionMode,this._rowFocusEventHandle&&(this.off("click",this._rowFocusEventHandle),this._rowFocusEventHandle=null),this._storeUpdateHandle&&(this._storeUpdateHandle.remove(),this._storeUpdateHandle=null)},rowEditValidator:function(a){a()},rowEditSaveHandler:function(){var a={},b=!0,c=Object.create(this._rowEditData);if(Object.keys(this._rowEditFields).forEach(function(d){var e=this._rowEditFields[d];if(e.getValue){"checkValidity"in e.editor&&(e.editor.checkValidity()||(b=!1));var f=e.getValue();f!==e.originalValue&&(a[d]=f,c[d]=f)}}.bind(this)),b)if(Object.keys(a).length>0){var d={};d[this._lastEditRow]=a,this.rowEditValidator(function(){null!==this._lastEditRow&&this.table.collection.get(this._lastEditRow).then(function(b){var d=void 0===b;d?(this.table.collection.add(c),this.refresh()):(Object.keys(a).forEach(function(b){this.table.updateDirty(this._lastEditRow,b,a[b])}.bind(this)),this.save()),this._rowEditDeleteOnCancel=!1,this.cancelRowEdit()}.bind(this))}.bind(this),d,this)}else this.rowEditCancelHandler()},rowEditCancelHandler:function(){this.cancelRowEdit()},cancelRowEdit:function(){if(null!==this._lastEditRow){this._cachedRowExpansion=null;var a=this._lastEditRow;this._lastEditRow=null,this._rowEditFields=null,this._hideRowEditor(a),this._rowEditDeleteOnCancel&&this.table.collection.remove(a)}},rowEditChangeHandler:function(a){this.emit("row-edit-update",{editors:a})},_showRowEditor:function(a,b){var c=this.row(a);if(c&&!b&&(b=c.data),this._rowEditData=b,this._rowEditFields=this._createFieldEditors(b),this._rowEditDeleteOnCancel=!1,g.isDesktop())this._rowEditingRenderer.setEditableRow(this,a,this._rowEditFields);else if(g.isHandheld())if(this._rowExpansion){this.reRenderRow(a);var d=this.row(a).element;this._rowExpansionTableRenderer._toggleRowExpansion(d,!1,d),f.setFocusOnAnyFirst(d.querySelector(".ha-table-row-expansion")),this._rowExpansionBlurEventHandle=function(b){for(var c=this.row(a).element,d=c.querySelector("table"),e=b.target,f=!1,g=!1,h=!1;e&&e!==document;)e===c?h=!0:e===d?f=!0:e.classList.contains("dgrid-row")&&(g=!0),e=e.parentNode;f?setTimeout(function(){this.rowEditCancelHandler()}.bind(this),0):g&&!h&&this.rowEditCancelHandler()}.bind(this),document.body.addEventListener("mouseup",this._rowExpansionBlurEventHandle)}else this.emit("row-edit",{row:a}),this.cancelRowEdit()},_prepareRowEditor:function(){g.isDesktop()&&(this.renderMode="rowEdit")},_hideRowEditor:function(a){if(this.allowRowEditing)if(g.isDesktop())this._rowEditingRenderer.setEditableRow(this,null,null);else if(g.isHandheld()&&this._rowExpansion){var b=this.row(a).element;this._rowExpansionTableRenderer._toggleRowExpansion(b,!0,b),this._rowExpansionBlurEventHandle&&(document.body.removeEventListener("mouseup",this._rowExpansionBlurEventHandle),this._rowExpansionBlurEventHandle=null)}},_putEditorsIntoRows:function(a){var b=[];Object.keys(a).forEach(function(c){var d=a[c];b.push(d)}.bind(this));for(var c=[];b.length;){for(var d=[b.shift()],e=d[0].column.drawerWeight||1;b.length&&e+(b[0].column.drawerWeight||1)<=1;){var f=b.shift();d.push(f),e+=f.column.drawerWeight||1}c.push(d)}return c},_createMobileEditor:function(a){var b=this.ownerDocument.createElement("div");if(b.style.width=Math.round(100*(a.column.drawerWeight||1))+"%",a.editor)a.editor.label=a.column.label,b.appendChild(a.editor);else{var c=this.ownerDocument.createElement("ha-text-field");c.label=a.column.label,c.disabled=!0,c.value=a.displayValue,b.appendChild(c)}return b},_createMobileRowExpansion:function(){var a=this.ownerDocument.createElement("div"),b=this.ownerDocument.createElement("section"),c=this.ownerDocument.createElement("footer"),d=this._rowEditFields,e=this.ownerDocument.createElement("header");if(this.rowEditTitle){var f=this.ownerDocument.createElement("h4");f.textContent=this.rowEditTitle,e.appendChild(f)}b.appendChild(e),this._putEditorsIntoRows(d).forEach(function(a){var c=document.createElement("div");c.className="row",a.forEach(function(a){c.appendChild(this._createMobileEditor(a))}.bind(this)),b.appendChild(c)}.bind(this));var g=this.ownerDocument.createElement("button");return g.className="ha-button ha-button-primary",g.textContent=this.rowEditSaveText,g.addEventListener("click",function(){this.rowEditSaveHandler()}.bind(this)),c.appendChild(g),a.appendChild(b),a.appendChild(c),a},_createFieldEditors:function(a){function b(a,b){var c="value";return a&&a.editorArgs&&a.editorArgs.value&&(c=a.editorArgs.value),function(a){b[c]=a}}function c(a,b){var c="value";return a&&a.editorArgs&&a.editorArgs.value&&(c=a.editorArgs.value),function(){return b[c]}}function d(){var a={};Object.keys(e).forEach(function(b){e[b].editor&&(a[b]=e[b].editor)}),this.rowEditChangeHandler(a)}var e={},f=this.columns;return Object.keys(f).forEach(function(g){var h=f[g],i={};if(!h.hidden){if(i.column=h,i.value=a[h.field],h.formatter){var j=h.formatter,k=this.table.formatterScope;i.displayValue="string"==typeof j&&k?k[j](i.value,a):j(i.value,a)}else i.displayValue=i.value;if(h.editor){var l=document.createElement(h.editor);i.editor=l,h.editorInit&&h.editorInit(l,i.value,h),i.setValue=b(h,l),i.setValue(i.value),i.getValue=c(h,l),i.originalValue=i.getValue(),l.addEventListener("change",d.bind(this))}e[g]=i}}.bind(this)),e},addAndEditRow:function(){if(this.allowRowEditing){var a;this._lastEditRow&&this.cancelRowEdit(),g.isDesktop()?(a=this.addEmptyRows(1),this._lastEditRow=a,this._showRowEditor(a)):g.isHandheld()&&(a=this.addEmptyRows(1),this._lastEditRow=a,this._showRowEditor(a),this._rowExpansionRenderer||(this._rowEditDeleteOnCancel=!0))}else this.addEmptyRows(1)},_createEmptyRow:function(){var a={};Object.keys(this.columns).forEach(function(b){"id"!==b&&(a[b]="")}.bind(this));var b=0;return this.table.collection.data.forEach(function(a){a.id&&(b=Math.max(a.id,b))}.bind(this)),a.id=b+1,a},addEmptyRows:function(a){a=Math.max(0,a||1);for(var b=null;a--;){var c=this._createEmptyRow();b=c.id,this.table.collection.add(c)}return this.refresh(),b},_getSortOptions:function(){var a,b=this.table?this.table.get("_columns"):[],c=[],d=this.table?this.table.get("sort")[0]:void 0,e=!1;return b.forEach(function(b){if(b.sortable!==!1){var f={column:b,field:b.field,label:b.label||b.field};void 0!==d&&d.property===b.field&&(f.sorted=!0,f.descending=d.descending,e=!0,a=d.descending),c.push(f)}}),!e&&c.length>0&&(c[0].sorted=!0,c[0].descending=!1,a=!1),{options:c,sortDescending:a}},_buildMobileSortOptions:function(){var a,b,c,d=this.ownerDocument,e=this._sortOptionsNode,f=this._getSortOptions(),g=f.options,h=f.sortDescending;e.innerHTML="",g.length>0&&this.showMobileSortOptions?(this._sortNode.style.display="block",b=d.createElement("ha-radio-button-group"),b.name="sort",c=[],g.forEach(function(b){a=d.createElement("ha-radio-button"),a.value=b.field,a.label=b.label,a.name="sort",b.sorted&&(a.checked=!0),c.push(a)}),b.radios=c,e.appendChild(b),e.appendChild(d.createElement("h4")),e.lastChild.textContent=this.mobileSortOrderText,b=d.createElement("ha-radio-button-group"),b.name="sortDir",c=[],c.push(d.createElement("ha-radio-button")),c[0].value="asc",c[0].label=this.mobileSortAscendingText,c[0].name="sortDir",c[0].checked=!h,c.push(d.createElement("ha-radio-button")),c[1].value="desc",c[1].label=this.mobileSortDescendingText,c[1].name="sortDir",c[1].checked=h,b.radios=c,e.appendChild(b)):this._sortNode.style.display="none"}}),b("ha-table",s)}),define("hui/table/ContentGroupMemory",["dojo/_base/declare","dojo/Deferred","dojo/when","dstore/QueryResults","dstore/Memory","dstore/Tree"],function(a,b,c,d,e,f){function g(a){return function(){var e,f=new b;try{f.resolve(this[a].apply(this,arguments))}catch(a){f.reject(a)}return e=new d(f.promise),e.totalLength=c(e.totalLength),e}}return a([e,f],{_lastExpanded:null,_forceGroupOrder:!1,forceGroupOrder:function(a){this._forceGroupOrder!==a&&(this._lastExpanded=null),this._forceGroupOrder=a},fetchGroupRangeSync:function(a){var b,c,e,f,g,h,i,j,k=this.data,l=a.start,m=a.end,n=m,o=a.virtual,p=a.expanded||[],q=null,r=this._forceGroupOrder?[]:null,s=!1,t=this._getRoots(),u=this,v=!1,w=0;if(this._lastExpanded)if(this._lastExpanded.length!==p.length)s=!0;else for(c=0;c<p.length;c++)this._lastExpanded[c]!==p[c]&&(s=!0);else s=!0;if(!k||k._version!==this.storage.version||s){for(k=this.storage.fullData,this._lastExpanded=p.map(function(a){return String(a)}),k=k.filter(function(a){return t.indexOf(a)<0}),b=this.queryLog,c=0,e=b.length;c<e;c++)b[c].querier.isSort?v=!0:i=!0,k=b[c].querier(k,t);for(v||(k=this._sortAndCombineChildCollections(this._getChildCollections(k,t))),this.totalLength=k.length,c=0;c<k.length;)if(null===q||k[c].parent!==q)for(q=k[c].parent,e=0;e<t.length;e++){if(this.getIdentity(t[e])===q){if(k.splice(c,0,t.splice(e,1)[0]),r){for(f=0;f<r.length;f++)k.splice(c,0,r[f]),c++;r=[]}c+=2;break}r&&(r.unshift(t.splice(e,1)[0]),e--)}else c++;k=k.filter(function(a){return u._lastExpanded.indexOf(String(a.parent))>=0||"undefined"==typeof a.parent||null===a.parent}),k._version=this.storage.version,this.data=k}else t=t.filter(function(a){return k.indexOf(a)<0});for(l>=k.length&&(h=m-l,l=Math.floor((k.length-2)/h)*h,m=l+h),c=0;c<m&&c<k.length;c++)this.mayHaveChildren(k[c])&&(m++,c<l&&!o&&(l++,w++));return k=k.slice(l,m),g=k.length,g<m-l||n>=this.totalLength?(t.length>0&&!i&&(k=k.concat(t)),j=new d(k,{totalLength:this.totalLength}),j.isLastPage=!0):j=new d(k,{totalLength:this.totalLength}),h&&(j.start=l-w+1),j},_createSortQuerier:function(a){var b=this,c=function(c,d){var e="function"==typeof a?a:function(b,c){var d,e,f,g,h,i;for(d=0;d<a.length;d++)if("function"==typeof a[d]?e=a[d](b,c):(f=a[d].property,g=a[d].descending,h=b.get?b.get(f):b[f],i=c.get?c.get(f):c[f],null!=h&&(h=h.valueOf()),null!=i&&(i=i.valueOf()),e=h===i?0:!!g==(null===h||h>i&&null!==i)?-1:1),0!==e)return e;return 0},f=b._getChildCollections(c.slice(),d);return c=b._sortAndCombineChildCollections(f,e)};return c.isSort=!0,c},_sortAndCombineChildCollections:function(a,b){var c,d=function(a,c){return a&&a[0]?c&&c[0]?b?b(a[0],c[0]):0:-1:c&&c[0]?1:0};if(b)for(c=0;c<a.length;c++)a[c].sort(b);for(this._forceGroupOrder||a.sort(d),c=1;c<a.length;c++)a[0]=a[0].concat(a[c]);return a[0]},_getChildCollections:function(a,b){var c,d,e=[];for(d=0;d<b.length;d++)c=this.getIdentity(b[d]),e.push(a.filter(function(a){return a.parent===c}));return e},_getRoots:function(){return this.storage.fullData.filter(function(a){return null==a.parent})},mayHaveChildren:function(a){return"undefined"==typeof a.parent||null===a.parent},fetchGroupRange:g("fetchGroupRangeSync")})}),define("hui/table/ContentGroupRequest",["dojo/_base/declare","dojo/_base/lang","dojo/request","dstore/Request","dstore/QueryResults"],function(a,b,c,d,e){return a(d,{_forceGroupOrder:!1,forceGroupOrder:function(a){this._forceGroupOrder=a},_renderExpandedParams:function(a){var b=a.length?this._forceGroupOrder?"&forceGroupOrder=true":"":this._forceGroupOrder?"forceGroupOrder=true":"";return a.map(function(a){return"expanded="+a}).join("&")+b},_renderRangeParams:function(){var a,b=arguments[2],c=this.inherited(arguments);return a=this._renderExpandedParams(b),a&&(c=c||[],c.push(a)),c},fetchGroupRange:function(a){var b,c,d,f=a.start,g=a.end,h=a.expanded||[],i={};return this.useRangeHeaders?(i.headers=this._renderRangeHeaders(f,g),c=this._renderExpandedParams(h),c&&(i.queryParams=[c])):i.queryParams=this._renderRangeParams(f,g,h),b=this._request(i),d=new e(b.data,{totalLength:b.total,response:b.response}),d.then?d.then(function(a){a.isLastPage=b.isLastPage,a.start=b.start}):(d.isLastPage=b.isLastPage,d.start=b.start),d},mayHaveChildren:function(a){return"undefined"==typeof a.parent||null===a.parent},_request:function(a){a=a||{};var d,e,f,g,h=b.delegate(this.headers,{Accept:this.accepts});return"headers"in a&&b.mixin(h,a.headers),d=this._renderUrl(a.queryParams),e=c(d,{method:"GET",headers:h}),f=this,g=e.then(function(a){return f.parse(a)}),{data:g.then(function(a){var b,c,d=a.items||a;for(b=0,c=d.length;b<c;b++)d[b]=f._restore(d[b],!0);return d}),total:g.then(function(a){var b=a.total;return b>-1?b:e.response.then(function(a){var b=a.getHeader("Content-Range");return b&&(b=b.match(/\/(.*)/))&&+b[1]})}),response:e.response,isLastPage:g.then(function(a){return a.isLastPage}),start:g.then(function(a){return a.start})}}})}),define("hui/table/RendererFactoryRegistry",["../core/utils","object-utils/classes","./rendererFactoryFactory"],function(a,b,c){var d=b.extend(Object,{constructor:function(a){this.rendererClassesMap=a||{},console.warn("DEPRECATION WARNING: The RendererFactoryRegistry is deprecated and should should not be used anymore. Use the Table#addRenderMode method instead to directly add a render mode to a table")},getRendererFactory:function(){var a,b={};for(a in this.rendererClassesMap)this.rendererClassesMap.hasOwnProperty(a)&&(b[a]=new this.rendererClassesMap[a]);return c(b)},registerRenderer:function(a,b){this.rendererClassesMap[a]=b}});return d}),define("hui/table-virtual",["register-component/v2/register","object-utils/classes","./table","./table/TableBase","./core/keys"],function(a,b,c,d,e){var f=b.createObject(c.prototype,{_createGrid:function(){var a=d.factory({table:this,virtual:!0,columns:this._getColumns()},this._gridNode);return a.addKeyHandler(e.ESCAPE,this._escapeHandler.bind(this)),a},_escapeHandler:function(){var a=this._getNextFocusableSibling()||this.querySelector(".table-escape-node");a.focus()},_getNextFocusableSibling:function(){for(var a=this.nextElementSibling;a;){if(a.focus&&(a.focus(),this.ownerDocument.activeElement===a))return a;a=a.nextElementSibling}},_shouldShowPaginationSettings:function(){return!1}});return a("ha-table-virtual",f)}),function(a,b){if("function"==typeof define&&define.amd)define("hui-react/table/PromiseManagerSingle",["exports","dojo/Deferred"],b);else if("undefined"!=typeof exports)b(exports,require("dojo/Deferred"));else{var c={exports:{}};b(c.exports,a.Deferred),a.PromiseManagerSingle=c.exports}}(this,function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{default:a}}function d(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(a,"__esModule",{value:!0});var e=c(b),f=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),g=function(){function a(){d(this,a),this.promise=null}return f(a,[{key:"getPromise",value:function(){return this.promise=this.promise||new e.default,this.promise}},{key:"getNewPromise",value:function(){return this.promise&&this.promise.cancel(),this.promise=new e.default,this.promise}},{key:"resolvePromise",value:function(a){this.promise&&(this.promise.resolve(a),this.promise=null)}},{key:"sort",value:function(){}},{key:"destroy",value:function(){this.promise&&(this.promise.cancel(),this.promise=null)}}]),a}();a.default=g});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a};!function(a,b){if("function"==typeof define&&define.amd)define("hui-react/table/CallbackCollection",["exports","dstore/Store","dstore/QueryResults","./PromiseManagerSingle"],b);else if("undefined"!=typeof exports)b(exports,require("dstore/Store"),require("dstore/QueryResults"),require("./PromiseManagerSingle"));else{var c={exports:{}};b(c.exports,a.Store,a.QueryResults,a.PromiseManagerSingle),a.CallbackCollection=c.exports}}(this,function(a,b,c,d){"use strict";function e(a){return a&&a.__esModule?a:{default:a}}function f(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function g(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==("undefined"==typeof b?"undefined":_typeof(b))&&"function"!=typeof b?a:b}function h(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(a,"__esModule",{value:!0});var i=e(b),j=e(c),k=e(d),l=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),m=function a(b,c,d){null===b&&(b=Function.prototype);var e=Object.getOwnPropertyDescriptor(b,c);if(void 0===e){var f=Object.getPrototypeOf(b);return null===f?void 0:a(f,c,d)}if("value"in e)return e.value;var g=e.get;if(void 0!==g)return g.call(d)},n=function(a){function b(a){f(this,b);var c=g(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.name="CallbackCollection",c.onDataChanged=a.onDataChanged,c.state={sortColumn:null,sortDescending:null,data:null,promiseManager:new k.default},c}return h(b,a),l(b,[{key:"sort",value:function(a){var c=a[0];return this.state.sortColumn=c.property,this.state.sortDescending=c.descending,this.state.promiseManager.sort(this.state.sortColumn,this.state.sortDescending),m(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"sort",this).call(this,a)}},{key:"fetchRange",value:function(a){var b=void 0,c=void 0,d={start:a.start,end:a.end,sortColumn:this.state.sortColumn,sortDescending:this.state.sortDescending};return this.state.data&&this.state.data.results?(c=this.state.promiseManager.getPromise(d),b=this.createResults(c),this.state.promiseManager.resolvePromise(this.state.data,d),this.state.data=null):(c=this.state.promiseManager.getNewPromise(d),b=this.createResults(c),this.onDataChanged(d)),b}},{key:"createResults",value:function(a){return new j.default(a.then(function(a){var b=a.results;return b.start=a.start+1,b}),{totalLength:a.then(function(a){return a.total})})}},{key:"setData",value:function(a){this.state.data=a}},{key:"destroy",value:function(){this.state.promiseManager.destroy(),this.onDataChanged=null,this.state=null}}]),b}(i.default);a.default=n}),function(a,b){if("function"==typeof define&&define.amd)define("hui-react/table/EventFilters",["exports"],b);else if("undefined"!=typeof exports)b(exports);else{var c={exports:{}};b(c.exports),a.EventFilters=c.exports}}(this,function(a){"use strict";function b(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(a,"__esModule",{value:!0});var c=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),d=function(){function a(){b(this,a)}return c(a,null,[{key:"noFilter",value:function(a){return a}},{key:"filterSelection",value:function(a){var b=a.rows.map(function(a){return a.data});return{eventSelection:b,tableSelectionById:a.grid.selection}}}]),a}();a.default=d}),function(a,b){if("function"==typeof define&&define.amd)define("hui-react/table/config",["exports","./EventFilters"],b);else if("undefined"!=typeof exports)b(exports,require("./EventFilters"));else{var c={exports:{}};b(c.exports,a.EventFilters),a.config=c.exports}}(this,function(a,b){"use strict";function c(a){return a&&a.__esModule?a:{default:a}}Object.defineProperty(a,"__esModule",{value:!0});var d=c(b);a.default={customOptions:{onOtherSettingsRender:!0,renderModes:!0,onTableBarCustomRender:!0,onTableBarCustomActionRender:!0,virtual:!0,totals:!0},apiToExpose:{clearErrors:!0,onClickEdit:!0,refresh:!0,resize:!0,resizeColumnWidth:!0,revert:!0,save:!0},eventsToCallbacks:{onCancel:{name:"edit-cancel",filter:d.default.noFilter},onColumnHiddenChange:{name:"column-hidden-change",filter:d.default.noFilter},onColumnResize:{name:"column-resize",filter:d.default.noFilter},onDatachange:{name:"datachange",filter:d.default.noFilter},onDeselect:{name:"batch-deselect",filter:d.default.filterSelection},onError:{name:"error",filter:d.default.noFilter},onExport:{name:"export",filter:d.default.noFilter},onRefresh:{name:"refresh",filter:d.default.noFilter},onSelect:{name:"batch-select",filter:d.default.filterSelection},onSave:{name:"edit-save",filter:d.default.noFilter},onSort:{name:"sort",filter:d.default.noFilter}}}}),function(a,b){if("function"==typeof define&&define.amd)define("hui-react/table/PropUtils",["exports"],b);else if("undefined"!=typeof exports)b(exports);else{var c={exports:{}};b(c.exports),a.PropUtils=c.exports}}(this,function(a){"use strict";Object.defineProperty(a,"__esModule",{value:!0});var b="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a},c=function(a){return!!a&&"object"===("undefined"==typeof a?"undefined":b(a))&&!Array.isArray(a)},d=function(a,b){return"for prop '"+a+"' in '"+b+".'"};a.default={getKey:function(a){return a.start+"-"+a.end+"-"+a.sortColumn+"-"+a.sortDescending},validateData:function(a,e,f){var g=void 0,h=d(e,f);return g=!a.collection||a.data||a.onDataChanged?!a.collection&&a.onDataChanged&&c(a.data)?null:a.collection&&(a.data||a.onDataChanged)?new Error("(101) "+h+" Prop 'collection' was specified but is not allowed when using props 'data' or 'onDataChanged'."):a.onDataChanged&&!c(a.data)?new Error("(102) "+h+" Prop 'onDataChanged' was specified but was not accompanied by prop 'data' of type object."):Array.isArray(a.data)?null:new Error("(103) "+h+" Prop 'data' must be an array. Type '"+b(a.data)+"' was found."):null;
},validateOptions:function(a,e,f){var g=void 0,h=d(e,f);return g=a.options?c(a.options)?a.options.virtual&&a.onDataChanged?new Error("(202) "+h+" Prop 'onDataChanged' was specified but it does not work with the 'virtual' true option."):null:new Error("(201) "+h+" Prop 'options' must be an object. Type '"+b(a.options)+"' was found."):null}}}),define("hui/table/LazyRowExpansionRenderer",["hui/table/DefaultRenderer","object-utils/classes","hui/core/keys","hui/core/a11y","hui/core/utils"],function(a,b,c,d,e){function f(a,b){var c=!0;if(a&&a.target){for(var d=a.target;d&&"HA-TABLE"!==d.tagName;)d.classList.contains(b)?(c=!1,d=null):d=d.parentElement;"HA-CHECKBOX"!==a.target.tagName&&"HA-RADIO-BUTTON"!==a.target.tagName&&"INPUT"!==a.target.tagName&&"BUTTON"!==a.target.tagName&&"A"!==a.target.tagName||(c=!1)}return c}function g(a,b){b?a.querySelector(".dgrid-grid").classList.add("animate-height"):a.querySelector(".dgrid-grid").classList.remove("animate-height")}var h=0;return b.extend(a,{constructor:function(a){a=a||{},this.renderRowExpansionContent=a.renderRowExpansionContent||function(a){var b=this.table.ownerDocument.createElement("div"),c=this.table.store.getIdentity(a);return b.textContent="RowExpansion content for row with object id: "+c,b},this.activatorSelector=a.activatorSelector,this.expansionHeight=a.expansionHeight,this.manualActivation=a.manualActivation||!1,this.expansionClassName=a.expansionClassName,this.useFocusIndicator=a.useFocusIndicator||!1,this.focusIndicatorLabel=a.focusIndicatorLabel||"",this._expandedRows={},this.scrollingThreshold=a.scrollingThreshold||!1,this.autoResizeTable=a.autoResizeTable||!1,a.activatorSelector||(this.tableConfig={selectionMode:"none"})},_expansionMouseHandler:function(a){a.stopPropagation()},_toggleRowExpansion:function(a,b,c){var d,f,h=a.querySelector(".ha-table-row-expansion"),i=this.table.row(a);if(h||(this.lazyRenderRowExpansion(a,b,c),h=a.querySelector(".ha-table-row-expansion")),a.querySelector("."+this.batchClass)?(h.classList.add("batch-table-expansion"),h.classList.remove("no-batch-table-expansion")):(h.classList.add("no-batch-table-expansion"),h.classList.remove("batch-table-expansion")),"undefined"!=typeof b&&null!==b?d=!Boolean(b):(f=h.classList.contains("hidden")!==h.classList.contains("hide-expansion"),d=h.classList.contains("hidden")),!f)if(d){if(this._expandedRows[i.id]=!0,h.classList.remove("hidden"),this.useFocusIndicator&&a.classList.add("show-focus"),setTimeout(function(){h.classList.remove("hide-expansion"),this._handleFocusAndAriaAttributes(h,c,a)}.bind(this),0),this.scrollingThreshold!==!1){for(var j=a;j&&!j.classList.contains("dgrid-scroller");)j=j.parentElement;j&&setTimeout(function(){var b=j.getBoundingClientRect(),c=a.getBoundingClientRect();(b.bottom-c.top)/c.height<this.scrollingThreshold&&e.animateScrollTo(j,a.offsetTop,150)}.bind(this),50)}this._autoResize()}else delete this._expandedRows[i.id],h.classList.add("hide-expansion"),this.useFocusIndicator&&a.classList.remove("show-focus"),setTimeout(function(){h.classList.add("hidden")}.bind(this),350),this.autoResizeTable&&setTimeout(function(){g(this.table,!0),this.table._calculateInitialHeight({type:"row-expander-resize"}),setTimeout(function(){g(this.table,!1)}.bind(this),250)}.bind(this),250),this._handleFocusAndAriaAttributes(h,c,a)},lazyRenderRowExpansion:function(a,b,e){var g,h=this.table,i=h.ownerDocument.createElement("div"),j=function(b,c){(this.activatorSelector||f(b,this.batchClass))&&this._toggleRowExpansion(a,c,e)}.bind(this),k=function(b,c){this._toggleRowExpansion(a,c,e)}.bind(this),l=function(a){a.keyCode===c.ESCAPE&&j(),d.keepFocusInsideListener(a,i)}.bind(this),m=e._expansionData,n=this.renderRowExpansionContent(m,k),o=h.ownerDocument.createElement("button"),p=a.querySelector("."+this.batchClass);if(i.id=e._expansionId,this.expansionHeight&&(i.style.height=this.expansionHeight+"px"),o.className="hi hi-close close-expansion-button",o.addEventListener("click",k),o.setAttribute("aria-label","Close expanded row"),i.appendChild(n),this.manualActivation||(n.appendChild(o),i.setAttribute("tabindex","-1"),i.addEventListener("keydown",l),i.addEventListener("click",this._expansionMouseHandler),i.addEventListener("mousedown",this._expansionMouseHandler),i.addEventListener("touchstart",this._expansionMouseHandler)),i.className="ha-table-row-expansion",m.id in this._expandedRows||(i.classList.add("hide-expansion"),i.classList.add("hidden")),this.expansionClassName&&i.classList.add(this.expansionClassName),p?i.classList.add("batch-table-expansion"):i.classList.add("no-batch-table-expansion"),this.useFocusIndicator){var q=document.createElement("button"),r=function(){this._toggleRowExpansion(a,!0,e)}.bind(this);q.className="focus-indicator hi hi-chevron-down",this.focusIndicatorLabel&&q.setAttribute("aria-label",this.focusIndicatorLabel),q.addEventListener("click",r),a.appendChild(q)}g=function(){o&&o.removeEventListener&&(o.removeEventListener("click",k),n&&n.removeChild&&n.removeChild(o)),q&&q.removeEventListener&&q.removeEventListener("click",r),i&&i.removeEventListener&&(i.removeEventListener("keydown",l),i.removeEventListener("click",this._expansionMouseHandler),i.removeEventListener("mousedown",this._expansionMouseHandler),i.removeEventListener("touchstart",this._expansionMouseHandler))},i.cleanUpListeners=function(){g&&g(),n&&n.destroy&&n.destroy()},a.appendChild(i)},_handleFocusAndAriaAttributes:function(a,b,c){a.classList.contains("hide-expansion")?(b.hasAttribute("tabindex")||(b.setAttribute("tabindex","-1"),b.addEventListener("blur",function a(){b.removeAttribute("tabindex"),b.removeEventListener("blur",a)})),b.focus(),b.setAttribute("aria-expanded",!1),c.classList.remove("highlighted-dgrid-row"),this.table.emit("expandable-row-close",{bubbles:!1,row:c})):(b.setAttribute("aria-expanded",!0),c.classList.add("highlighted-dgrid-row"),a.focus(),this.table.emit("expandable-row-show",{bubbles:!1,row:c}))},_autoResize:function(){this.autoResizeTable&&setTimeout(function(){this.table._calculateInitialHeight({type:"row-expander-resize"})}.bind(this),250)},addExpansionListeners:function(a,b){var d,e,g=a.querySelector("table")||a,i=function(b,c){(this.activatorSelector||f(b,this.batchClass))&&this._toggleRowExpansion(a,c,g)}.bind(this),j=function(a){a.keyCode!==c.ENTER&&a.keyCode!==c.SPACEBAR||i(a)};return e=function(){g&&g.removeEventListener&&(g.removeEventListener("click",i),"BUTTON"!==g.tagName&&g.removeEventListener("keydown",j))},this.manualActivation||(this.activatorSelector&&(g=a.querySelector(this.activatorSelector)),d="table-row-expansion"+h++,g._expansionId=d,g._expansionData=b,g._keyboardEventHandler=j,g.setAttribute("aria-controls",d),g.setAttribute("aria-expanded",!1),e&&e(),g&&g.addEventListener&&(g.addEventListener("click",i),"BUTTON"!==g.tagName&&g.addEventListener("keydown",j))),this._expandedRows&&!0===this._expandedRows[b.id]&&(this.lazyRenderRowExpansion(a,!1,g),this._autoResize()),a.destroy=function(){var b=a.querySelector(".ha-table-row-expansion");b&&b.cleanUpListeners&&b.cleanUpListeners(),e&&e()},a},row:function(a,b,c){var d=c();return this.addExpansionListeners(d,a,b)},setup:function(){this.batchClass="field-"+this.table.batchField}})});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol?"symbol":typeof a};!function(a,b){if("function"==typeof define&&define.amd)define("hui-react/table/Table",["exports","react","react-dom","dstore/Memory","./CallbackCollection","./config","./PropUtils","hui/table/LazyRowExpansionRenderer","hui/table","hui/table-virtual","xstyle/css!hui-css/hui-table.min.css"],b);else if("undefined"!=typeof exports)b(exports,require("react"),require("react-dom"),require("dstore/Memory"),require("./CallbackCollection"),require("./config"),require("./PropUtils"),require("hui/table/LazyRowExpansionRenderer"),require("hui/table"),require("hui/table-virtual"),require("xstyle/css!hui-css/hui-table.min.css"));else{var c={exports:{}};b(c.exports,a.react,a.reactDom,a.Memory,a.CallbackCollection,a.config,a.PropUtils,a.LazyRowExpansionRenderer,a.table,a.tableVirtual,a.huiTableMin),a.Table=c.exports}}(this,function(a,b,c,d,e,f,g,h){"use strict";function i(a){return a&&a.__esModule?a:{default:a}}function j(a,b){if(!(a instanceof b))throw new TypeError("Cannot call a class as a function")}function k(a,b){if(!a)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!b||"object"!==("undefined"==typeof b?"undefined":_typeof(b))&&"function"!=typeof b?a:b}function l(a,b){if("function"!=typeof b&&null!==b)throw new TypeError("Super expression must either be null or a function, not "+typeof b);a.prototype=Object.create(b&&b.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),b&&(Object.setPrototypeOf?Object.setPrototypeOf(a,b):a.__proto__=b)}Object.defineProperty(a,"__esModule",{value:!0});var m=i(b),n=i(c),o=i(d),p=i(e),q=i(f),r=i(g),s=i(h),t=function(){function a(a,b){for(var c=0;c<b.length;c++){var d=b[c];d.enumerable=d.enumerable||!1,d.configurable=!0,"value"in d&&(d.writable=!0),Object.defineProperty(a,d.key,d)}}return function(b,c,d){return c&&a(b.prototype,c),d&&a(b,d),b}}(),u=function(a){function b(a){j(this,b);var c=k(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,a));return c.api={},c.store=null,c.totals=null,c.table=null,c.cache={},c.otherSettingsNode=null,c.tableBarCustomNode=null,c.tableBarCustomActionNode=null,c}return l(b,a),t(b,null,[{key:"displayName",get:function(){return"Table"}},{key:"propTypes",get:function(){return{columns:m.default.PropTypes.object.isRequired,data:r.default.validateData,onDataChanged:m.default.PropTypes.func,collection:m.default.PropTypes.object,options:r.default.validateOptions}}}]),t(b,[{key:"componentDidMount",value:function(){this.table=this.renderTable(),this.wrapper.appendChild(this.table)}},{key:"shouldComponentUpdate",value:function(a){return this.mixinOptions(this.table,a.options),this.connectCallbacks(this.table,a.options),this.setStoreData(a.data),this.postTableRender(this.table,a.options,a.data),this.table.columns=this.adaptColumns(a.columns),!1}},{key:"componentWillUnmount",value:function(){this.otherSettingsNode&&n.default.unmountComponentAtNode(this.otherSettingsNode),this.tableBarCustomNode&&n.default.unmountComponentAtNode(this.tableBarCustomNode),this.tableBarCustomActionNode&&n.default.unmountComponentAtNode(this.tableBarCustomActionNode),this.clearCache(),this.store.destroy&&this.store.destroy(),this.table=null,this.api=null,this.totals=null,this.store=null,this.wrapper=null,this.otherSettingsNode=null,this.tableBarCustomNode=null,this.tableBarCustomActionNode=null,this.cache=null}},{key:"clearCache",value:function(){var a=this;Object.keys(this.cache).forEach(function(b){n.default.unmountComponentAtNode(a.cache[b])}),this.cache={}}},{key:"handleWrapperRef",value:function(a){this.wrapper=a}},{key:"shouldUpdateTableProperty",value:function(a,b,c){return!q.default.customOptions[b]&&!q.default.eventsToCallbacks[b]&&a[b]!==c}},{key:"connectCallbacks",value:function(a,b){a&&b&&Object.keys(q.default.eventsToCallbacks).forEach(function(c){var d=b[c],e=void 0,f=void 0,g=void 0;d&&(e=q.default.eventsToCallbacks[c],f=e.name,g=e.filter,a.off(f),a.on(f,function(a){var b=g(a);d(b)}))})}},{key:"mixinOptions",value:function(a,b){var c=this;a&&b&&Object.keys(b).forEach(function(d){var e=b[d];c.shouldUpdateTableProperty(a,d,e)&&(a[d]=e)})}},{key:"adaptColumns",value:function(a){var b=this,c={};return Object.keys(a).forEach(function(d){var e=void 0,f=b;c[d]=a[d],e=c[d].onRenderCell,e&&(c[d].renderCell=function(a,b,c,d){var g=e({rowData:a,value:b,options:d,column:this.field});return f.renderReactCell(g,this.field,a,b,c)})}),c}},{key:"renderReactCell",value:function(a,b,c,d,e){var f=this.store.getIdentity(c),g=this.getCellKey(f,b),h=this.cache[g],i=h||document.createElement("div");n.default.render(a,i),this.cache[g]=i,e.appendChild(i)}},{key:"getCellKey",value:function(a,b){return a+"-"+b}},{key:"getStore",value:function(){var a=void 0;return a=this.store?this.store:this.props.collection?this.props.collection:this.props.onDataChanged?new p.default({onDataChanged:this.props.onDataChanged,allowMultipleConcurrentRequests:this.props.options.virtual}):new o.default}},{key:"shouldSyncCallbackCollection",value:function(){return this.table&&this.table.table&&this.table.table._renderedCollection&&"CallbackCollection"===this.table.table._renderedCollection.name}},{key:"setStoreData",value:function(a){a&&(this.store.setData(a),this.shouldSyncCallbackCollection()&&(this.table.table._renderedCollection.state=this.store.state))}},{key:"exposeApi",value:function(a){var b=this;Object.keys(q.default.apiToExpose).forEach(function(c){b.api[c]=function(){return a[c].apply(a,arguments)}})}},{key:"addRenderModes",value:function(a,b){var c=this;b&&b.renderModes&&b.renderModes.forEach(function(b){var d=b.renderer.expansionHeight,e=b.renderer.activatorSelector,f=b.renderer.autoResizeTable,g=b.renderer.scrollingThreshold,h=b.renderer.expansionClassName,i=b.renderer.useFocusIndicator,j=b.renderer.focusIndicatorLabel,k=null,l=null;b.renderer.onRenderRowExpansionContent&&(k=function(a,d){var e=b.renderer.onRenderRowExpansionContent({object:a,hideExpansion:d});return c.renderReactRowExpansionContent(e)}),l=s.default.bind(null,{activatorSelector:e,expansionHeight:d,renderRowExpansionContent:k,autoResizeTable:f,scrollingThreshold:g,expansionClassName:h,useFocusIndicator:i,focusIndicatorLabel:j}),a.addRenderMode(b.renderMode,new l)})}},{key:"renderReactRowExpansionContent",value:function(a){var b=document.createElement("div");return n.default.render(a,b),b}},{key:"updateRowSelection",value:function(a,b){var c=this,d=b.results||b;d&&d.length>0&&d.forEach(function(b){var d=c.store.getIdentity(b),e=a.row(d);b._selected===!0?a.select(e):b._selected===!1&&a.deselect(e)})}},{key:"applyOtherSettings",value:function(a,b){if(b.onOtherSettingsRender){var c=b.onOtherSettingsRender();n.default.render(c,a.otherSettingsNode),this.otherSettingsNode=a.otherSettingsNode}}},{key:"applyTableBarCustomContent",value:function(a,b){if(b.onTableBarCustomRender){var c=b.onTableBarCustomRender();n.default.render(c,a.tableBarCustomNode),this.tableBarCustomNode=a.tableBarCustomNode}if(b.onTableBarCustomActionRender){var d=b.onTableBarCustomActionRender();n.default.render(d,a.tableBarCustomActionNode),this.tableBarCustomActionNode=a.tableBarCustomActionNode}}},{key:"applyTotals",value:function(a,b){var c=this;b.totals&&!this.totals&&a.on("table-resize",function(){a.totals=c.totals}),this.totals=b.totals}},{key:"postTableRender",value:function(a,b,c){b&&(this.applyOtherSettings(a,b),this.applyTableBarCustomContent(a,b),this.applyTotals(a,b)),c&&this.updateRowSelection(a,c)}},{key:"renderTable",value:function(){var a=this.props.options,b=a&&a.virtual?"ha-table-virtual":"ha-table",c=document.createElement(b);return this.store=this.getStore(),this.setStoreData(this.props.data),this.mixinOptions(c,a),this.connectCallbacks(c,a),c.collection=this.store,c.columns=this.adaptColumns(this.props.columns),this.exposeApi(c),this.postTableRender(c,a,this.props.data),a&&a.renderModes&&this.addRenderModes(c,a),c}},{key:"render",value:function(){var a=this.handleWrapperRef.bind(this);return m.default.createElement("div",{className:"ha-table-react-wrapper",ref:a})}}]),b}(m.default.Component);a.default=u}),define("../../build/dist/js/hui-table",function(){});
//# sourceMappingURL=hui-table.min.map