{"version":3,"sources":["../../../react-components/HAPortal.jsx"],"names":[],"mappings":"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","file":"HAPortal.js","sourcesContent":["import React from 'react';\nimport ReactDOM, { findDOMNode } from 'react-dom';\nimport Position from \"hui/core/position\"\nconst shallowCompare = React.addons.shallowCompare;\nlet underlayZIndex = [];\n\nexport default class Portal extends React.Component {\n\n  static propTypes = {\n    children: React.PropTypes.element.isRequired\n  };\n\n  constructor() {\n    super();\n    this.potral = null;\n    this.container = null;\n  }\n\n  componentDidMount() {\n    this.potral = document.createElement('div');\n    document.body.appendChild(this.potral);\n    // use unstable_renderSubtreeIntoContainer to pass relay context\n    this.container = ReactDOM.unstable_renderSubtreeIntoContainer(this, this.props.children, this.potral);\n  }\n\n  componentWillUpdate(nextProps) {\n    if (nextProps.show) {\n      // use unstable_renderSubtreeIntoContainer to pass relay context\n      this.container = ReactDOM.unstable_renderSubtreeIntoContainer(this, nextProps.children, this.potral);\n\n      // if the container does not have a z-index we need to calculate one for it\n      // this can happen if it's a new container, or a container we hid that has not been unmounted yet\n      // if a drawer does not have a background, noUnderlay is true and we do not have to modify the underlay\n      if (!this.container.style.zIndex && !this.props.noUnderlay) {\n        // underlay must get moved first to it's z-index is less than the container's\n        this.moveUnderlay(Position.getTopZindex());\n      }\n      if (!this.container.style.zIndex) {\n        this.container.style.zIndex = Position.getTopZindex();\n      }\n    } else if (nextProps.show === false && this.container && this.container.style.zIndex) {\n        // move underlay (or remove it)\n        this.removeUnderlay();\n\n        // remove z-index so we can determine new z-index if we show it again before unmounting it\n        this.container.style.zIndex = null;\n      }\n  }\n\n  shouldComponentUpdate(nextProps, nextState) {\n    return shallowCompare(this, nextProps, nextState);\n  }\n\n  componentWillUnmount() {\n      // even if show prop hasn't been updated - still clean up underlay\n      this.removeUnderlay();\n\n      if (this.potral) {\n          ReactDOM.unmountComponentAtNode(this.potral);\n          document.body.removeChild(this.potral);\n      }\n      this.potral = null;\n      this.container = null;\n  }\n\n    removeUnderlay() {\n        // if a drawer doesn't have a background, noUnderlay is true and we don't have to modify the underlay\n        if (!this.props.noUnderlay) {\n            const underlay = document.body.querySelector(\".ha-underlay\");\n\n            // if there are multiple layers, pop the top one and move the underlay down a layer.\n            // else there aren't any more layers so just remove underlay from the DOM\n            if (underlayZIndex.pop() && underlayZIndex.length) {\n                underlay.style.zIndex = underlayZIndex[underlayZIndex.length - 1];\n            } else if (underlay) {\n                document.body.removeChild(underlay);\n            }\n        }\n    }\n\n  moveUnderlay(zIndex) {\n    let underlay = document.body.querySelector(\".ha-underlay\");\n\n    // if there is no underlay div, create one and append to the body\n    if(!underlay) {\n      underlay = document.createElement('div');\n      underlay.classList.add('ha-underlay');\n      underlay.tabIndex = -1;\n      document.body.appendChild(underlay);\n    }\n    underlay.style.zIndex = zIndex;\n    underlayZIndex.push(zIndex);\n  }\n\n  render() {\n    return null;\n  }\n}"]}